<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- 'makeLenses' produces unused lenses.</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-unused-binds #-}</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE MonadComprehensions #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings   #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell     #-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.PlutusCore.TypeSynthesis</span><span> </span><span class="hs-special">(</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typecheckProgram"><span class="hs-identifier hs-var">typecheckProgram</span></a><span>
</span><a name="line-10"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typecheckTerm"><span class="hs-identifier hs-var">typecheckTerm</span></a><span>
</span><a name="line-11"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheck"><span class="hs-identifier hs-var">kindCheck</span></a><span>
</span><a name="line-12"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#runTypeCheckM"><span class="hs-identifier hs-var">runTypeCheckM</span></a><span>
</span><a name="line-13"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#runInTypeCheckM"><span class="hs-identifier hs-var">runInTypeCheckM</span></a><span>
</span><a name="line-14"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dynamicBuiltinNameMeaningsToTypes"><span class="hs-identifier hs-var">dynamicBuiltinNameMeaningsToTypes</span></a><span>
</span><a name="line-15"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#DynamicBuiltinNameTypes"><span class="hs-identifier hs-type">DynamicBuiltinNameTypes</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span>
</span><a name="line-17"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Error.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier hs-type">TypeConfig</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>                                         </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Constant.html"><span class="hs-identifier">Language.PlutusCore.Constant</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Error.html"><span class="hs-identifier">Language.PlutusCore.Error</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Lexer.Type.html"><span class="hs-identifier">Language.PlutusCore.Lexer.Type</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Lexer.Type.html#name"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Name.html"><span class="hs-identifier">Language.PlutusCore.Name</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Normalize.html"><span class="hs-identifier">Language.PlutusCore.Normalize</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Quote.html"><span class="hs-identifier">Language.PlutusCore.Quote</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Renamer.html"><span class="hs-identifier">Language.PlutusCore.Renamer</span></a><span>    </span><span class="hs-special">(</span><a href="Language.PlutusCore.Renamer.html#rename"><span class="hs-identifier hs-var">rename</span></a><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Type.html"><span class="hs-identifier">Language.PlutusCore.Type</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><a href="PlutusPrelude.html"><span class="hs-identifier">PlutusPrelude</span></a><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Lens</span><span>                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">coerced</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Lens.TH</span><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">makeLenses</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Error.Lens</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Except</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Reader</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.IntMap</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IM</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Map</span><span>                       </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span>                       </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-comment">{- Note [Costs]
Typechecking costs are relatively simple: it costs 1 gas to perform a reduction.
Substitution does not in general cost anything.

Costs are reset every time we enter 'NormalizeTypeT'.

In unlimited mode, gas is not tracked and we do not fail even on large numbers of reductions.
-}</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">-- | Mapping from 'DynamicBuiltinName's to their 'Type's.</span><span>
</span><a name="line-50"></a><span class="hs-keyword">newtype</span><span> </span><a name="DynamicBuiltinNameTypes"><a href="Language.PlutusCore.TypeSynthesis.html#DynamicBuiltinNameTypes"><span class="hs-identifier">DynamicBuiltinNameTypes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="DynamicBuiltinNameTypes"><a href="Language.PlutusCore.TypeSynthesis.html#DynamicBuiltinNameTypes"><span class="hs-identifier">DynamicBuiltinNameTypes</span></a></a><span>
</span><a name="line-51"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="unDynamicBuiltinNameTypes"><a href="Language.PlutusCore.TypeSynthesis.html#unDynamicBuiltinNameTypes"><span class="hs-identifier">unDynamicBuiltinNameTypes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#DynamicBuiltinName"><span class="hs-identifier hs-type">DynamicBuiltinName</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Semigroup</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-comment">-- TODO: define @UniqueMap@ already.</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-keyword">newtype</span><span> </span><a name="TyVarKinds"><a href="Language.PlutusCore.TypeSynthesis.html#TyVarKinds"><span class="hs-identifier">TyVarKinds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TyVarKinds"><a href="Language.PlutusCore.TypeSynthesis.html#TyVarKinds"><span class="hs-identifier">TyVarKinds</span></a></a><span>
</span><a name="line-57"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="unTyVarKinds"><a href="Language.PlutusCore.TypeSynthesis.html#unTyVarKinds"><span class="hs-identifier">unTyVarKinds</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IM.IntMap</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Semigroup</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-keyword">newtype</span><span> </span><a name="VarTypes"><a href="Language.PlutusCore.TypeSynthesis.html#VarTypes"><span class="hs-identifier">VarTypes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="VarTypes"><a href="Language.PlutusCore.TypeSynthesis.html#VarTypes"><span class="hs-identifier">VarTypes</span></a></a><span>
</span><a name="line-61"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="unVarTypes"><a href="Language.PlutusCore.TypeSynthesis.html#unVarTypes"><span class="hs-identifier">unVarTypes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IM.IntMap</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Semigroup</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- This is just to be able to say 'mempty'.</span><span>
</span><a name="line-63"></a><span>                                    </span><span class="hs-comment">-- TODO: Remove this once this is not visible to the user.</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">-- TODO: split 'TypeConfig' to 'TypeEnv' and 'TypeConfig'.</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-comment">-- | Configuration of the type checker.</span><span>
</span><a name="line-68"></a><span class="hs-keyword">data</span><span> </span><a name="TypeConfig"><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier">TypeConfig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TypeConfig"><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier">TypeConfig</span></a></a><span>
</span><a name="line-69"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="_typeConfigNormalize"><a href="Language.PlutusCore.TypeSynthesis.html#_typeConfigNormalize"><span class="hs-identifier">_typeConfigNormalize</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-70"></a><span>      </span><span class="hs-comment">-- ^ Whether to normalize type annotations.</span><span>
</span><a name="line-71"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_typeConfigDynBuiltinNameTypes"><a href="Language.PlutusCore.TypeSynthesis.html#_typeConfigDynBuiltinNameTypes"><span class="hs-identifier">_typeConfigDynBuiltinNameTypes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#DynamicBuiltinNameTypes"><span class="hs-identifier hs-type">DynamicBuiltinNameTypes</span></a><span>
</span><a name="line-72"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_typeConfigTyVarKinds"><a href="Language.PlutusCore.TypeSynthesis.html#_typeConfigTyVarKinds"><span class="hs-identifier">_typeConfigTyVarKinds</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TyVarKinds"><span class="hs-identifier hs-type">TyVarKinds</span></a><span>
</span><a name="line-73"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_typeConfigVarTypes"><a href="Language.PlutusCore.TypeSynthesis.html#_typeConfigVarTypes"><span class="hs-identifier">_typeConfigVarTypes</span></a></a><span>            </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#VarTypes"><span class="hs-identifier hs-type">VarTypes</span></a><span>
</span><a name="line-74"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_typeConfigGas"><a href="Language.PlutusCore.TypeSynthesis.html#_typeConfigGas"><span class="hs-identifier">_typeConfigGas</span></a></a><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.PlutusCore.Type.html#Gas"><span class="hs-identifier hs-type">Gas</span></a><span>
</span><a name="line-75"></a><span>       </span><span class="hs-comment">-- ^ The upper limit on the length of type reductions.</span><span>
</span><a name="line-76"></a><span>       </span><span class="hs-comment">-- If set to 'Nothing', type reductions will be unbounded.</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">-- | The type checking monad contains the 'TypeConfig' and it lets us throw 'TypeError's.</span><span>
</span><a name="line-80"></a><span class="hs-keyword">type</span><span> </span><a name="TypeCheckM"><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier">TypeCheckM</span></a></a><span> </span><a name="local-6989586621679593760"><a href="#local-6989586621679593760"><span class="hs-identifier">ann</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">ReaderT</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier hs-type">TypeConfig</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ExceptT</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a><span> </span><a href="#local-6989586621679593760"><span class="hs-identifier hs-type">ann</span></a><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.Quote.html#Quote"><span class="hs-identifier hs-type">Quote</span></a><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-identifier hs-var">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">TypeConfig</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-comment">-- | Run a 'NormalizeTypeT' computation in the 'TypeCheckM' context.</span><span>
</span><a name="line-85"></a><span class="hs-comment">-- Depending on whether gas is finite or infinite, calls either</span><span>
</span><a name="line-86"></a><span class="hs-comment">-- 'runNormalizeTypeDownM' or 'runNormalizeTypeGasM'.</span><span>
</span><a name="line-87"></a><span class="hs-comment">-- Throws 'OutOfGas' if type normalization runs out of gas.</span><span>
</span><a name="line-88"></a><span class="hs-identifier">runInTypeCheckM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679594410"><a href="#local-6989586621679594410"><span class="hs-identifier">m</span></a></a><span class="hs-operator">.</span><span> </span><a href="Language.PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a><span> </span><a href="#local-6989586621679594410"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.Normalize.html#NormalizeTypeT"><span class="hs-identifier hs-type">NormalizeTypeT</span></a><span> </span><a href="#local-6989586621679594410"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679594406"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679594407"><span class="hs-identifier hs-type">ann1</span></a><span> </span><a href="#local-6989586621679594408"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594409"><span class="hs-identifier hs-type">ann2</span></a><span> </span><a href="#local-6989586621679594408"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-89"></a><a name="runInTypeCheckM"><a href="Language.PlutusCore.TypeSynthesis.html#runInTypeCheckM"><span class="hs-identifier">runInTypeCheckM</span></a></a><span> </span><a name="local-6989586621679594411"><a href="#local-6989586621679594411"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-90"></a><span>    </span><a name="local-6989586621679594412"><a href="#local-6989586621679594412"><span class="hs-identifier">mayGas</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-identifier">_typeConfigGas</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679594412"><span class="hs-identifier hs-var">mayGas</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-92"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Normalize.html#runNormalizeTypeDownM"><span class="hs-identifier hs-var">runNormalizeTypeDownM</span></a><span> </span><a href="#local-6989586621679594411"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-93"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679594413"><a href="#local-6989586621679594413"><span class="hs-identifier">gas</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-94"></a><span>            </span><a name="local-6989586621679594414"><a href="#local-6989586621679594414"><span class="hs-identifier">mayX</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Normalize.html#runNormalizeTypeGasM"><span class="hs-identifier hs-var">runNormalizeTypeGasM</span></a><span> </span><a href="#local-6989586621679594413"><span class="hs-identifier hs-var">gas</span></a><span> </span><a href="#local-6989586621679594411"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-95"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679594414"><span class="hs-identifier hs-var">mayX</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-96"></a><span>                </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwing</span><span> </span><a href="Language.PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a><span> </span><a href="Language.PlutusCore.Error.html#OutOfGas"><span class="hs-identifier hs-var">OutOfGas</span></a><span>
</span><a name="line-97"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679594415"><a href="#local-6989586621679594415"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679594415"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-identifier">withTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><a href="#local-6989586621679594404"><span class="hs-identifier hs-type">ann</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594404"><span class="hs-identifier hs-type">ann</span></a><span> </span><a href="#local-6989586621679594405"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594404"><span class="hs-identifier hs-type">ann</span></a><span> </span><a href="#local-6989586621679594405"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-100"></a><a name="withTyVar"><a href="Language.PlutusCore.TypeSynthesis.html#withTyVar"><span class="hs-identifier">withTyVar</span></a></a><span> </span><a name="local-6989586621679594416"><a href="#local-6989586621679594416"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-101"></a><span>    </span><span class="hs-identifier hs-var">local</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">over</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeConfigTyVarKinds"><span class="hs-identifier hs-var">typeConfigTyVarKinds</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">coerce</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">IM.insert</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679594416"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Language.PlutusCore.Name.html#unique"><span class="hs-identifier hs-var">unique</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">coerced</span><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-identifier">withVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><a href="#local-6989586621679594402"><span class="hs-identifier hs-type">ann</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594402"><span class="hs-identifier hs-type">ann</span></a><span> </span><a href="#local-6989586621679594403"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594402"><span class="hs-identifier hs-type">ann</span></a><span> </span><a href="#local-6989586621679594403"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-104"></a><a name="withVar"><a href="Language.PlutusCore.TypeSynthesis.html#withVar"><span class="hs-identifier">withVar</span></a></a><span> </span><a name="local-6989586621679594417"><a href="#local-6989586621679594417"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-identifier hs-var">local</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">over</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeConfigVarTypes"><span class="hs-identifier hs-var">typeConfigVarTypes</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">coerce</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">IM.insert</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679594417"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Language.PlutusCore.Name.html#unique"><span class="hs-identifier hs-var">unique</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">coerced</span><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-comment">-- | Normalize a 'Type'.</span><span>
</span><a name="line-108"></a><span class="hs-identifier">normalizeTypeTcm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594401"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-109"></a><a name="normalizeTypeTcm"><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeTcm"><span class="hs-identifier">normalizeTypeTcm</span></a></a><span> </span><a name="local-6989586621679594418"><a href="#local-6989586621679594418"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#runInTypeCheckM"><span class="hs-identifier hs-var">runInTypeCheckM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Normalize.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a><span> </span><a href="#local-6989586621679594418"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">-- | Substitute a type for a variable in a type and normalize the result.</span><span>
</span><a name="line-112"></a><span class="hs-identifier">substituteNormalizeTypeTcm</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                 </span><span class="hs-comment">-- ^ @ty@</span><span>
</span><a name="line-114"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                                </span><span class="hs-comment">-- ^ @name@</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                           </span><span class="hs-comment">-- ^ @body@</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594400"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><a name="substituteNormalizeTypeTcm"><a href="Language.PlutusCore.TypeSynthesis.html#substituteNormalizeTypeTcm"><span class="hs-identifier">substituteNormalizeTypeTcm</span></a></a><span> </span><a name="local-6989586621679594419"><a href="#local-6989586621679594419"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679594420"><a href="#local-6989586621679594420"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679594421"><a href="#local-6989586621679594421"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#runInTypeCheckM"><span class="hs-identifier hs-var">runInTypeCheckM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Normalize.html#substituteNormalizeTypeM"><span class="hs-identifier hs-var">substituteNormalizeTypeM</span></a><span> </span><a href="#local-6989586621679594419"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679594420"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679594421"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-comment">-- | Normalize a 'Type' or simply wrap it in the 'NormalizedType' constructor</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- if we are working with normalized type annotations.</span><span>
</span><a name="line-121"></a><span class="hs-identifier">normalizeTypeOptTcm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594399"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-122"></a><a name="normalizeTypeOptTcm"><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier">normalizeTypeOptTcm</span></a></a><span> </span><a name="local-6989586621679594422"><a href="#local-6989586621679594422"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-123"></a><span>    </span><a name="local-6989586621679594423"><a href="#local-6989586621679594423"><span class="hs-identifier">normalize</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-identifier">_typeConfigNormalize</span><span>
</span><a name="line-124"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679594423"><span class="hs-identifier hs-var">normalize</span></a><span>
</span><a name="line-125"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeTcm"><span class="hs-identifier hs-var">normalizeTypeTcm</span></a><span> </span><a href="#local-6989586621679594422"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-126"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><a href="#local-6989586621679594422"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-identifier">sizeToType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-129"></a><a name="sizeToType"><a href="Language.PlutusCore.TypeSynthesis.html#sizeToType"><span class="hs-identifier">sizeToType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Size"><span class="hs-identifier hs-var">Size</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-comment">-- | Get the 'Kind' of a 'TypeBuiltin'.</span><span>
</span><a name="line-132"></a><span class="hs-identifier">kindOfTypeBuiltin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TypeBuiltin"><span class="hs-identifier hs-type">TypeBuiltin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-133"></a><a name="kindOfTypeBuiltin"><a href="Language.PlutusCore.TypeSynthesis.html#kindOfTypeBuiltin"><span class="hs-identifier">kindOfTypeBuiltin</span></a></a><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TyInteger"><span class="hs-identifier hs-var">TyInteger</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#sizeToType"><span class="hs-identifier hs-var">sizeToType</span></a><span>
</span><a name="line-134"></a><span class="hs-identifier">kindOfTypeBuiltin</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TyByteString"><span class="hs-identifier hs-var">TyByteString</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#sizeToType"><span class="hs-identifier hs-var">sizeToType</span></a><span>
</span><a name="line-135"></a><span class="hs-identifier">kindOfTypeBuiltin</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TySize"><span class="hs-identifier hs-var">TySize</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#sizeToType"><span class="hs-identifier hs-var">sizeToType</span></a><span>
</span><a name="line-136"></a><span class="hs-identifier">kindOfTypeBuiltin</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TyString"><span class="hs-identifier hs-var">TyString</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">-- TODO: move me to a separate API module once it's there.</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- | Extract the 'TypeScheme' from a 'DynamicBuiltinNameMeaning' and convert it to the</span><span>
</span><a name="line-140"></a><span class="hs-comment">-- corresponding @Type TyName@ for each row of a 'DynamicBuiltinNameMeanings'.</span><span>
</span><a name="line-141"></a><span class="hs-identifier">dynamicBuiltinNameMeaningsToTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Constant.Typed.html#DynamicBuiltinNameMeanings"><span class="hs-identifier hs-type">DynamicBuiltinNameMeanings</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#DynamicBuiltinNameTypes"><span class="hs-identifier hs-type">DynamicBuiltinNameTypes</span></a><span>
</span><a name="line-142"></a><a name="dynamicBuiltinNameMeaningsToTypes"><a href="Language.PlutusCore.TypeSynthesis.html#dynamicBuiltinNameMeaningsToTypes"><span class="hs-identifier">dynamicBuiltinNameMeaningsToTypes</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Constant.Typed.html#DynamicBuiltinNameMeanings"><span class="hs-identifier hs-var">DynamicBuiltinNameMeanings</span></a><span> </span><a name="local-6989586621679594424"><a href="#local-6989586621679594424"><span class="hs-identifier">means</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-143"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#DynamicBuiltinNameTypes"><span class="hs-identifier hs-var">DynamicBuiltinNameTypes</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679594425"><span class="hs-identifier hs-var">toType</span></a><span> </span><a href="#local-6989586621679594424"><span class="hs-identifier hs-var">means</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-144"></a><span>        </span><span class="hs-comment">-- TODO: kind check the types before normalizing them. We can't do that right now</span><span>
</span><a name="line-145"></a><span>        </span><span class="hs-comment">-- in a nice way, because 'kindCheck' infers the kind of a type rather than checks a type</span><span>
</span><a name="line-146"></a><span>        </span><span class="hs-comment">-- against a kind.</span><span>
</span><a name="line-147"></a><span>        </span><span class="hs-comment">-- We call 'runQuote' here in order to prevent renormalization at each look-up.</span><span>
</span><a name="line-148"></a><span>        </span><span class="hs-comment">-- It's fine to do so, because we rename types in 'lookupDynamicBuiltinName'.</span><span>
</span><a name="line-149"></a><span>        </span><a name="local-6989586621679594425"><a href="#local-6989586621679594425"><span class="hs-identifier">toType</span></a></a><span> </span><a name="local-6989586621679594426"><a href="#local-6989586621679594426"><span class="hs-identifier">mean</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Quote.html#runQuote"><span class="hs-identifier hs-var">runQuote</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Constant.Function.html#dynamicBuiltinNameMeaningToType"><span class="hs-identifier hs-var">dynamicBuiltinNameMeaningToType</span></a><span> </span><a href="#local-6989586621679594426"><span class="hs-identifier hs-var">mean</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Language.PlutusCore.Renamer.html#rename"><span class="hs-identifier hs-var">rename</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Language.PlutusCore.Normalize.html#normalizeTypeDown"><span class="hs-identifier hs-var">normalizeTypeDown</span></a><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-comment">-- | Type-check a program, returning a normalized type.</span><span>
</span><a name="line-152"></a><span class="hs-identifier">typecheckProgram</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#AsTypeError"><span class="hs-identifier hs-type">AsTypeError</span></a><span> </span><a href="#local-6989586621679594396"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679594397"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadError</span><span> </span><a href="#local-6989586621679594396"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679594398"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a><span> </span><a href="#local-6989586621679594398"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-153"></a><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier hs-type">TypeConfig</span></a><span>
</span><a name="line-154"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Program"><span class="hs-identifier hs-type">Program</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><a href="Language.PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><a href="#local-6989586621679594397"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-155"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679594398"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-156"></a><a name="typecheckProgram"><a href="Language.PlutusCore.TypeSynthesis.html#typecheckProgram"><span class="hs-identifier">typecheckProgram</span></a></a><span> </span><a name="local-6989586621679594427"><a href="#local-6989586621679594427"><span class="hs-identifier">cfg</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Program"><span class="hs-identifier hs-var">Program</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594428"><a href="#local-6989586621679594428"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typecheckTerm"><span class="hs-identifier hs-var">typecheckTerm</span></a><span> </span><a href="#local-6989586621679594427"><span class="hs-identifier hs-var">cfg</span></a><span> </span><a href="#local-6989586621679594428"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-comment">-- | Type-check a term, returning a normalized type.</span><span>
</span><a name="line-159"></a><span class="hs-identifier">typecheckTerm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#AsTypeError"><span class="hs-identifier hs-type">AsTypeError</span></a><span> </span><a href="#local-6989586621679594393"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679594394"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadError</span><span> </span><a href="#local-6989586621679594393"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679594395"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a><span> </span><a href="#local-6989586621679594395"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier hs-type">TypeConfig</span></a><span>
</span><a name="line-161"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><a href="Language.PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><a href="#local-6989586621679594394"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-162"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679594395"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-163"></a><a name="typecheckTerm"><a href="Language.PlutusCore.TypeSynthesis.html#typecheckTerm"><span class="hs-identifier">typecheckTerm</span></a></a><span> </span><a name="local-6989586621679594429"><a href="#local-6989586621679594429"><span class="hs-identifier">cfg</span></a></a><span> </span><a name="local-6989586621679594430"><a href="#local-6989586621679594430"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Error.html#throwingEither"><span class="hs-identifier hs-var">throwingEither</span></a><span> </span><a href="Language.PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">runExceptT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#runTypeCheckM"><span class="hs-identifier hs-var">runTypeCheckM</span></a><span> </span><a href="#local-6989586621679594429"><span class="hs-identifier hs-var">cfg</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679594430"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-comment">-- | Kind-check a PLC type.</span><span>
</span><a name="line-166"></a><span class="hs-identifier">kindCheck</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#AsTypeError"><span class="hs-identifier hs-type">AsTypeError</span></a><span> </span><a href="#local-6989586621679594390"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679594391"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadError</span><span> </span><a href="#local-6989586621679594390"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679594392"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a><span> </span><a href="#local-6989586621679594392"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier hs-type">TypeConfig</span></a><span>
</span><a name="line-168"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><a href="#local-6989586621679594391"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-169"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679594392"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><a name="kindCheck"><a href="Language.PlutusCore.TypeSynthesis.html#kindCheck"><span class="hs-identifier">kindCheck</span></a></a><span> </span><a name="local-6989586621679594431"><a href="#local-6989586621679594431"><span class="hs-identifier">cfg</span></a></a><span> </span><a name="local-6989586621679594432"><a href="#local-6989586621679594432"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Error.html#throwingEither"><span class="hs-identifier hs-var">throwingEither</span></a><span> </span><a href="Language.PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">runExceptT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#runTypeCheckM"><span class="hs-identifier hs-var">runTypeCheckM</span></a><span> </span><a href="#local-6989586621679594431"><span class="hs-identifier hs-var">cfg</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><a href="#local-6989586621679594432"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span class="hs-comment">-- | Run the type checker with a default context.</span><span>
</span><a name="line-173"></a><span class="hs-identifier">runTypeCheckM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeConfig"><span class="hs-identifier hs-type">TypeConfig</span></a><span>
</span><a name="line-174"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594388"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679594389"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-175"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExceptT</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a><span> </span><a href="#local-6989586621679594388"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.Quote.html#Quote"><span class="hs-identifier hs-type">Quote</span></a><span> </span><a href="#local-6989586621679594389"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-176"></a><a name="runTypeCheckM"><a href="Language.PlutusCore.TypeSynthesis.html#runTypeCheckM"><span class="hs-identifier">runTypeCheckM</span></a></a><span> </span><a name="local-6989586621679594433"><a href="#local-6989586621679594433"><span class="hs-identifier">typeConfig</span></a></a><span> </span><a name="local-6989586621679594434"><a href="#local-6989586621679594434"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runReaderT</span><span> </span><a href="#local-6989586621679594434"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679594433"><span class="hs-identifier hs-var">typeConfig</span></a><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-comment">-- | Infer the kind of a type variable by looking it up in the current context.</span><span>
</span><a name="line-179"></a><span class="hs-identifier">kindOfTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><a href="#local-6989586621679594387"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594387"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-180"></a><a name="kindOfTyVar"><a href="Language.PlutusCore.TypeSynthesis.html#kindOfTyVar"><span class="hs-identifier">kindOfTyVar</span></a></a><span> </span><a name="local-6989586621679594435"><a href="#local-6989586621679594435"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-181"></a><span>    </span><a name="local-6989586621679594436"><a href="#local-6989586621679594436"><span class="hs-identifier">mayKind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">IM.lookup</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679594435"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Language.PlutusCore.Name.html#unique"><span class="hs-identifier hs-var">unique</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">coerced</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unTyVarKinds</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">_typeConfigTyVarKinds</span><span>
</span><a name="line-182"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679594436"><span class="hs-identifier hs-var">mayKind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-183"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Error.html#FreeTypeVariableE"><span class="hs-identifier hs-var">FreeTypeVariableE</span></a><span> </span><a href="#local-6989586621679594435"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-184"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679594437"><a href="#local-6989586621679594437"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679594437"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-comment">-- | Infer the type of a variable by looking it up in the current context.</span><span>
</span><a name="line-187"></a><span class="hs-identifier">typeOfVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><a href="#local-6989586621679594386"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594386"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-188"></a><a name="typeOfVar"><a href="Language.PlutusCore.TypeSynthesis.html#typeOfVar"><span class="hs-identifier">typeOfVar</span></a></a><span> </span><a name="local-6989586621679594438"><a href="#local-6989586621679594438"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-189"></a><span>    </span><a name="local-6989586621679594439"><a href="#local-6989586621679594439"><span class="hs-identifier">mayTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">IM.lookup</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679594438"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Language.PlutusCore.Name.html#unique"><span class="hs-identifier hs-var">unique</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">coerced</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unVarTypes</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">_typeConfigVarTypes</span><span>
</span><a name="line-190"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679594439"><span class="hs-identifier hs-var">mayTy</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-191"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Error.html#FreeVariableE"><span class="hs-identifier hs-var">FreeVariableE</span></a><span> </span><a href="#local-6989586621679594438"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-192"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679594440"><a href="#local-6989586621679594440"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Renamer.html#rename"><span class="hs-identifier hs-var">rename</span></a><span> </span><a href="#local-6989586621679594440"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-comment">-- | Infer the kind of a type.</span><span>
</span><a name="line-195"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><a href="#local-6989586621679594385"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594385"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-comment">-- ---------------------------</span><span>
</span><a name="line-198"></a><span class="hs-comment">-- [infer| G !- con i :: size]</span><span>
</span><a name="line-199"></a><a name="kindOf"><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier">kindOf</span></a></a><span> </span><a href="Language.PlutusCore.Type.html#TyInt"><span class="hs-identifier hs-var">TyInt</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Size"><span class="hs-identifier hs-var">Size</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-comment">-- [check| G !- a :: *]    [check| G !- b :: *]</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- --------------------------------------------</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- [infer| G !- a -&gt; b :: *]</span><span>
</span><a name="line-204"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a><span> </span><a name="local-6989586621679594441"><a href="#local-6989586621679594441"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679594442"><a href="#local-6989586621679594442"><span class="hs-identifier">dom</span></a></a><span> </span><a name="local-6989586621679594443"><a href="#local-6989586621679594443"><span class="hs-identifier">cod</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-205"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679594441"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679594442"><span class="hs-identifier hs-var">dom</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679594441"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679594443"><span class="hs-identifier hs-var">cod</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span class="hs-comment">-- [check| G , n :: k !- body :: *]</span><span>
</span><a name="line-210"></a><span class="hs-comment">-- ---------------------------------------</span><span>
</span><a name="line-211"></a><span class="hs-comment">-- [infer| G !- (all (n :: k). body) :: *]</span><span>
</span><a name="line-212"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a><span> </span><a name="local-6989586621679594444"><a href="#local-6989586621679594444"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679594445"><a href="#local-6989586621679594445"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679594446"><a href="#local-6989586621679594446"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679594447"><a href="#local-6989586621679594447"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-213"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#withTyVar"><span class="hs-identifier hs-var">withTyVar</span></a><span> </span><a href="#local-6989586621679594445"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594446"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679594444"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679594447"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span class="hs-comment">-- [infer| G , n :: dom !- body :: cod]</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- -------------------------------------------------</span><span>
</span><a name="line-218"></a><span class="hs-comment">-- [infer| G !- (\(n :: dom) -&gt; body) :: dom -&gt; cod]</span><span>
</span><a name="line-219"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyLam"><span class="hs-identifier hs-var">TyLam</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594448"><a href="#local-6989586621679594448"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679594449"><a href="#local-6989586621679594449"><span class="hs-identifier">dom</span></a></a><span> </span><a name="local-6989586621679594450"><a href="#local-6989586621679594450"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-220"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679594451"><a href="#local-6989586621679594451"><span class="hs-identifier">dom_</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594449"><span class="hs-identifier hs-var">dom</span></a><span>
</span><a name="line-221"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#withTyVar"><span class="hs-identifier hs-var">withTyVar</span></a><span> </span><a href="#local-6989586621679594448"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679594451"><span class="hs-identifier hs-var">dom_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594451"><span class="hs-identifier hs-var">dom_</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><a href="#local-6989586621679594450"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-comment">-- [infer| G !- v :: k]</span><span>
</span><a name="line-224"></a><span class="hs-comment">-- ------------------------</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- [infer| G !- var v :: k]</span><span>
</span><a name="line-226"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594452"><a href="#local-6989586621679594452"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOfTyVar"><span class="hs-identifier hs-var">kindOfTyVar</span></a><span> </span><a href="#local-6989586621679594452"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-comment">-- [infer| G !- b :: k]</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- ------------------------</span><span>
</span><a name="line-230"></a><span class="hs-comment">-- [infer| G !- con b :: k]</span><span>
</span><a name="line-231"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyBuiltin"><span class="hs-identifier hs-var">TyBuiltin</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594453"><a href="#local-6989586621679594453"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOfTypeBuiltin"><span class="hs-identifier hs-var">kindOfTypeBuiltin</span></a><span> </span><a href="#local-6989586621679594453"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span class="hs-comment">-- [infer| G !- arg :: k]    [check| G !- pat :: (k -&gt; *) -&gt; k -&gt; *]</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- -----------------------------------------------------------------</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- [infer| G !- ifix pat arg :: *]</span><span>
</span><a name="line-236"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a><span> </span><a name="local-6989586621679594454"><a href="#local-6989586621679594454"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679594455"><a href="#local-6989586621679594455"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679594456"><a href="#local-6989586621679594456"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-237"></a><span>    </span><a name="local-6989586621679594457"><a href="#local-6989586621679594457"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><a href="#local-6989586621679594456"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-238"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckPatternFunctorM"><span class="hs-identifier hs-var">kindCheckPatternFunctorM</span></a><span> </span><a href="#local-6989586621679594454"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679594455"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679594457"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-239"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-comment">-- [infer| G !- fun :: dom -&gt; cod]    [check| G !- arg :: dom]</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- -----------------------------------------------------------</span><span>
</span><a name="line-243"></a><span class="hs-comment">-- [infer| G !- fun arg :: cod]</span><span>
</span><a name="line-244"></a><span class="hs-identifier">kindOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyApp"><span class="hs-identifier hs-var">TyApp</span></a><span> </span><a name="local-6989586621679594458"><a href="#local-6989586621679594458"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679594459"><a href="#local-6989586621679594459"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679594460"><a href="#local-6989586621679594460"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-245"></a><span>    </span><a name="local-6989586621679594461"><a href="#local-6989586621679594461"><span class="hs-identifier">funKind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><a href="#local-6989586621679594459"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-246"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679594461"><span class="hs-identifier hs-var">funKind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-247"></a><span>        </span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594462"><a href="#local-6989586621679594462"><span class="hs-identifier">dom</span></a></a><span> </span><a name="local-6989586621679594463"><a href="#local-6989586621679594463"><span class="hs-identifier">cod</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-248"></a><span>            </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679594458"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679594460"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621679594462"><span class="hs-identifier hs-var">dom</span></a><span>
</span><a name="line-249"></a><span>            </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679594463"><span class="hs-identifier hs-var">cod</span></a><span>
</span><a name="line-250"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Error.html#KindMismatch"><span class="hs-identifier hs-var">KindMismatch</span></a><span> </span><a href="#local-6989586621679594458"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594459"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyKind"><span class="hs-identifier hs-var">dummyKind</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyKind"><span class="hs-identifier hs-var">dummyKind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594461"><span class="hs-identifier hs-var">funKind</span></a><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-comment">-- | Check a 'Type' against a 'Kind'.</span><span>
</span><a name="line-253"></a><span class="hs-identifier">kindCheckM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679594384"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><a href="#local-6989586621679594384"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594384"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-comment">-- [infer| G !- ty : tyK]    tyK ~ k</span><span>
</span><a name="line-256"></a><span class="hs-comment">-- ---------------------------------</span><span>
</span><a name="line-257"></a><span class="hs-comment">-- [check| G !- ty : k]</span><span>
</span><a name="line-258"></a><a name="kindCheckM"><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier">kindCheckM</span></a></a><span> </span><a name="local-6989586621679594464"><a href="#local-6989586621679594464"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679594465"><a href="#local-6989586621679594465"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679594466"><a href="#local-6989586621679594466"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-259"></a><span>    </span><a name="local-6989586621679594467"><a href="#local-6989586621679594467"><span class="hs-identifier">tyK</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><a href="#local-6989586621679594465"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-260"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679594467"><span class="hs-identifier hs-var">tyK</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679594466"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#KindMismatch"><span class="hs-identifier hs-var">KindMismatch</span></a><span> </span><a href="#local-6989586621679594464"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594465"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594466"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679594467"><span class="hs-identifier hs-var">tyK</span></a><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>
</span><a name="line-262"></a><span class="hs-comment">-- | Check that the kind of a pattern functor is @(k -&gt; *) -&gt; k -&gt; *@.</span><span>
</span><a name="line-263"></a><span class="hs-identifier">kindCheckPatternFunctorM</span><span>
</span><a name="line-264"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679594383"><span class="hs-identifier hs-type">ann</span></a><span>
</span><a name="line-265"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><a href="#local-6989586621679594383"><span class="hs-identifier hs-type">ann</span></a><span>  </span><span class="hs-comment">-- ^ A pattern functor.</span><span>
</span><a name="line-266"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>          </span><span class="hs-comment">-- ^ @k@.</span><span>
</span><a name="line-267"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594383"><span class="hs-identifier hs-type">ann</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-268"></a><a name="kindCheckPatternFunctorM"><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckPatternFunctorM"><span class="hs-identifier">kindCheckPatternFunctorM</span></a></a><span> </span><a name="local-6989586621679594468"><a href="#local-6989586621679594468"><span class="hs-identifier">ann</span></a></a><span> </span><a name="local-6989586621679594469"><a href="#local-6989586621679594469"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679594470"><a href="#local-6989586621679594470"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-269"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679594468"><span class="hs-identifier hs-var">ann</span></a><span> </span><a href="#local-6989586621679594469"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594470"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#KindArrow"><span class="hs-identifier hs-var">KindArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594470"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span class="hs-comment">-- | Apply a 'TypeBuiltin' to a 'Size' and wrap in 'NormalizedType'.</span><span>
</span><a name="line-272"></a><span class="hs-identifier">applySizedNormalized</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TypeBuiltin"><span class="hs-identifier hs-type">TypeBuiltin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="#local-6989586621679594382"><span class="hs-identifier hs-type">tyname</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-273"></a><a name="applySizedNormalized"><a href="Language.PlutusCore.TypeSynthesis.html#applySizedNormalized"><span class="hs-identifier">applySizedNormalized</span></a></a><span> </span><a name="local-6989586621679594471"><a href="#local-6989586621679594471"><span class="hs-identifier">tb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.PlutusCore.Type.html#TyApp"><span class="hs-identifier hs-var">TyApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyBuiltin"><span class="hs-identifier hs-var">TyBuiltin</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594471"><span class="hs-identifier hs-var">tb</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.PlutusCore.Type.html#TyInt"><span class="hs-identifier hs-var">TyInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-identifier">dummyUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Name.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-276"></a><a name="dummyUnique"><a href="Language.PlutusCore.TypeSynthesis.html#dummyUnique"><span class="hs-identifier">dummyUnique</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Name.html#Unique"><span class="hs-identifier hs-var">Unique</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-identifier">dummyTyName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-279"></a><a name="dummyTyName"><a href="Language.PlutusCore.TypeSynthesis.html#dummyTyName"><span class="hs-identifier">dummyTyName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-var">TyName</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Name.html#Name"><span class="hs-identifier hs-var">Name</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;*&quot;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyUnique"><span class="hs-identifier hs-var">dummyUnique</span></a><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-identifier">dummyKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-282"></a><a name="dummyKind"><a href="Language.PlutusCore.TypeSynthesis.html#dummyKind"><span class="hs-identifier">dummyKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span class="hs-identifier">dummyType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-285"></a><a name="dummyType"><a href="Language.PlutusCore.TypeSynthesis.html#dummyType"><span class="hs-identifier">dummyType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyTyName"><span class="hs-identifier hs-var">dummyTyName</span></a><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span class="hs-comment">-- | Look up a 'DynamicBuiltinName' in the 'DynBuiltinNameTypes' environment.</span><span>
</span><a name="line-288"></a><span class="hs-identifier">lookupDynamicBuiltinName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679594381"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#DynamicBuiltinName"><span class="hs-identifier hs-type">DynamicBuiltinName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594381"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-289"></a><a name="lookupDynamicBuiltinName"><a href="Language.PlutusCore.TypeSynthesis.html#lookupDynamicBuiltinName"><span class="hs-identifier">lookupDynamicBuiltinName</span></a></a><span> </span><a name="local-6989586621679594472"><a href="#local-6989586621679594472"><span class="hs-identifier">ann</span></a></a><span> </span><a name="local-6989586621679594473"><a href="#local-6989586621679594473"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-290"></a><span>    </span><a name="local-6989586621679594474"><a href="#local-6989586621679594474"><span class="hs-identifier">dbnts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">unDynamicBuiltinNameTypes</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">_typeConfigDynBuiltinNameTypes</span><span>
</span><a name="line-291"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621679594473"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679594474"><span class="hs-identifier hs-var">dbnts</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-292"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-293"></a><span>            </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Error.html#UnknownDynamicBuiltinName"><span class="hs-identifier hs-var">UnknownDynamicBuiltinName</span></a><span> </span><a href="#local-6989586621679594472"><span class="hs-identifier hs-var">ann</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#UnknownDynamicBuiltinNameErrorE"><span class="hs-identifier hs-var">UnknownDynamicBuiltinNameErrorE</span></a><span> </span><a href="#local-6989586621679594473"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-294"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679594475"><a href="#local-6989586621679594475"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Renamer.html#rename"><span class="hs-identifier hs-var">rename</span></a><span> </span><a href="#local-6989586621679594475"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span class="hs-comment">-- | Get the 'Type' of a 'Constant' wrapped in 'NormalizedType'.</span><span>
</span><a name="line-297"></a><span class="hs-identifier">typeOfConstant</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a><span> </span><a href="#local-6989586621679594380"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-298"></a><a name="typeOfConstant"><a href="Language.PlutusCore.TypeSynthesis.html#typeOfConstant"><span class="hs-identifier">typeOfConstant</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#BuiltinInt"><span class="hs-identifier hs-var">BuiltinInt</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594476"><a href="#local-6989586621679594476"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#applySizedNormalized"><span class="hs-identifier hs-var">applySizedNormalized</span></a><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TyInteger"><span class="hs-identifier hs-var">TyInteger</span></a><span>    </span><a href="#local-6989586621679594476"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-299"></a><span class="hs-identifier">typeOfConstant</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#BuiltinBS"><span class="hs-identifier hs-var">BuiltinBS</span></a><span>   </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594477"><a href="#local-6989586621679594477"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#applySizedNormalized"><span class="hs-identifier hs-var">applySizedNormalized</span></a><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TyByteString"><span class="hs-identifier hs-var">TyByteString</span></a><span> </span><a href="#local-6989586621679594477"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-300"></a><span class="hs-identifier">typeOfConstant</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#BuiltinSize"><span class="hs-identifier hs-var">BuiltinSize</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594478"><a href="#local-6989586621679594478"><span class="hs-identifier">size</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#applySizedNormalized"><span class="hs-identifier hs-var">applySizedNormalized</span></a><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TySize"><span class="hs-identifier hs-var">TySize</span></a><span>       </span><a href="#local-6989586621679594478"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-301"></a><span class="hs-identifier">typeOfConstant</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#BuiltinStr"><span class="hs-identifier hs-var">BuiltinStr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#TyBuiltin"><span class="hs-identifier hs-var">TyBuiltin</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.Lexer.Type.html#TyString"><span class="hs-identifier hs-var">TyString</span></a><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-identifier">typeOfBuiltin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a><span> </span><a href="#local-6989586621679594379"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594379"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span class="hs-comment">-- We have a weird corner case here: the type of a 'BuiltinName' can contain 'TypedBuiltinDyn', i.e.</span><span>
</span><a name="line-305"></a><span class="hs-comment">-- a static built-in name is allowed to depend on a dynamic built-in type which are not required</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- to be normalized. For dynamic built-in names we store a map from them to their *normalized types*,</span><span>
</span><a name="line-307"></a><span class="hs-comment">-- with the normalization happening in this module, but what should we do for static built-in names?</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- Right now we just renormalize the type of a static built-in name each time we encounter that name.</span><span>
</span><a name="line-309"></a><a name="typeOfBuiltin"><a href="Language.PlutusCore.TypeSynthesis.html#typeOfBuiltin"><span class="hs-identifier">typeOfBuiltin</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#BuiltinName"><span class="hs-identifier hs-var">BuiltinName</span></a><span>    </span><span class="hs-identifier">_</span><span>   </span><a name="local-6989586621679594479"><a href="#local-6989586621679594479"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-310"></a><span>    </span><a href="Language.PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Constant.Function.html#typeOfBuiltinName"><span class="hs-identifier hs-var">typeOfBuiltinName</span></a><span> </span><a href="#local-6989586621679594479"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Language.PlutusCore.Renamer.html#rename"><span class="hs-identifier hs-var">rename</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Language.PlutusCore.Normalize.html#normalizeTypeDown"><span class="hs-identifier hs-var">normalizeTypeDown</span></a><span>
</span><a name="line-311"></a><span class="hs-identifier">typeOfBuiltin</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#DynBuiltinName"><span class="hs-identifier hs-var">DynBuiltinName</span></a><span> </span><a name="local-6989586621679594480"><a href="#local-6989586621679594480"><span class="hs-identifier">ann</span></a></a><span> </span><a name="local-6989586621679594481"><a href="#local-6989586621679594481"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#lookupDynamicBuiltinName"><span class="hs-identifier hs-var">lookupDynamicBuiltinName</span></a><span> </span><a href="#local-6989586621679594480"><span class="hs-identifier hs-var">ann</span></a><span> </span><a href="#local-6989586621679594481"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span class="hs-comment">{- Note [Type rules]
We write type rules in the bidirectional style.

[infer| G !- x : a] -- means that the inferred type of 'x' in the context 'G' is 'a'.
'a' is not necessary a varible, e.g. [infer| G !- fun : dom -&gt; cod] is fine too.
It reads as follows: &quot;infer the type of 'fun' in the context 'G', check that it's functional and
bind the 'dom' variable to the domain and the 'cod' variable to the codomain of this type&quot;.

Analogously, [infer| G !- t :: k] means that the inferred kind of 't' in the context 'G' is 'k'.
The [infer| G !- x : a] judgement appears in conclusions in the clauses of the 'typeOf' function.

[check| G !- x : a] -- check that the type of 'x' in the context 'G' is 'a'.
Since Plutus Core is a fully elaborated language, this amounts to inferring the type of 'x' and
checking that it's equal to 'a'.

Analogously, [check| G !- t :: k] means &quot;check that the kind of 't' in the context 'G' is 'k'&quot;.
The [check| G !- x : a] judgement appears in the conclusion in the sole clause of
the 'typeCheckM' function.

The equality check is denoted as &quot;a ~ b&quot;.

We use unified contexts, i.e. a context can carry type variables as well as term variables.

The &quot;NORM a&quot; notation reads as &quot;normalize 'a'&quot;.

The &quot;a ~&gt;? b&quot; notations reads as &quot;optionally normalize 'a' to 'b'&quot;. The &quot;optionally&quot; part is due to the
fact that we allow non-normalized types during development, but do not allow to submit them on a chain.
-}</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-comment">-- See the [Type rules] and [Type environments] notes.</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- | Synthesize the type of a term, returning a normalized type.</span><span>
</span><a name="line-344"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><a href="Language.PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><a href="#local-6989586621679594378"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594378"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span class="hs-comment">-- [infer| G !- v : ty]    ty ~&gt;? vTy</span><span>
</span><a name="line-347"></a><span class="hs-comment">-- ----------------------------------</span><span>
</span><a name="line-348"></a><span class="hs-comment">-- [infer| G !- var v : vTy]</span><span>
</span><a name="line-349"></a><a name="typeOf"><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier">typeOf</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594482"><a href="#local-6989586621679594482"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>                              </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOfVar"><span class="hs-identifier hs-var">typeOfVar</span></a><span> </span><a href="#local-6989586621679594482"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-350"></a><span>
</span><a name="line-351"></a><span class="hs-comment">-- [check| G !- dom :: *]    dom ~&gt;? vDom    [infer| G , n : dom !- body : vCod]</span><span>
</span><a name="line-352"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-353"></a><span class="hs-comment">-- [infer| G !- lam n dom body : vDom -&gt; vCod]</span><span>
</span><a name="line-354"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#LamAbs"><span class="hs-identifier hs-var">LamAbs</span></a><span> </span><a name="local-6989586621679594483"><a href="#local-6989586621679594483"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679594484"><a href="#local-6989586621679594484"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679594485"><a href="#local-6989586621679594485"><span class="hs-identifier">dom</span></a></a><span> </span><a name="local-6989586621679594486"><a href="#local-6989586621679594486"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-355"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679594483"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679594485"><span class="hs-identifier hs-var">dom</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-356"></a><span>    </span><a name="local-6989586621679594487"><a href="#local-6989586621679594487"><span class="hs-identifier">vDom</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier hs-var">normalizeTypeOptTcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594485"><span class="hs-identifier hs-var">dom</span></a><span>
</span><a name="line-357"></a><span>    </span><a href="Language.PlutusCore.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="PlutusPrelude.html#%3C%3C%24%3E%3E"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679594487"><span class="hs-identifier hs-var">vDom</span></a><span> </span><a href="PlutusPrelude.html#%3C%3C%2A%3E%3E"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#withVar"><span class="hs-identifier hs-var">withVar</span></a><span> </span><a href="#local-6989586621679594484"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679594487"><span class="hs-identifier hs-var">vDom</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679594486"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span>
</span><a name="line-358"></a><span>
</span><a name="line-359"></a><span class="hs-comment">-- [check| G !- ty :: *]    ty ~&gt;? vTy</span><span>
</span><a name="line-360"></a><span class="hs-comment">-- -----------------------------------</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- [infer| G !- error ty : vTy]</span><span>
</span><a name="line-362"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Error"><span class="hs-identifier hs-var">Error</span></a><span> </span><a name="local-6989586621679594488"><a href="#local-6989586621679594488"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679594489"><a href="#local-6989586621679594489"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-363"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679594488"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679594489"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-364"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier hs-var">normalizeTypeOptTcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594489"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-comment">-- [infer| G , n :: nK !- body : vBodyTy]</span><span>
</span><a name="line-367"></a><span class="hs-comment">-- ---------------------------------------------------</span><span>
</span><a name="line-368"></a><span class="hs-comment">-- [infer| G !- abs n nK body : all (n :: nK) vBodyTy]</span><span>
</span><a name="line-369"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyAbs"><span class="hs-identifier hs-var">TyAbs</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594490"><a href="#local-6989586621679594490"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679594491"><a href="#local-6989586621679594491"><span class="hs-identifier">nK</span></a></a><span> </span><a name="local-6989586621679594492"><a href="#local-6989586621679594492"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-370"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679594493"><a href="#local-6989586621679594493"><span class="hs-identifier">nK_</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594491"><span class="hs-identifier hs-var">nK</span></a><span>
</span><a name="line-371"></a><span>    </span><a href="Language.PlutusCore.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594490"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594493"><span class="hs-identifier hs-var">nK_</span></a><span> </span><a href="PlutusPrelude.html#%3C%3C%24%3E%3E"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#withTyVar"><span class="hs-identifier hs-var">withTyVar</span></a><span> </span><a href="#local-6989586621679594490"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679594493"><span class="hs-identifier hs-var">nK_</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679594492"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span>
</span><a name="line-372"></a><span>
</span><a name="line-373"></a><span class="hs-comment">-- [infer| G !- c : vTy]</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- -------------------------</span><span>
</span><a name="line-375"></a><span class="hs-comment">-- [infer| G !- con c : vTy]</span><span>
</span><a name="line-376"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Constant"><span class="hs-identifier hs-var">Constant</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594494"><a href="#local-6989586621679594494"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.TypeSynthesis.html#typeOfConstant"><span class="hs-identifier hs-var">typeOfConstant</span></a><span> </span><a href="#local-6989586621679594494"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-comment">-- [infer| G !- bi : vTy]</span><span>
</span><a name="line-379"></a><span class="hs-comment">-- ------------------------------</span><span>
</span><a name="line-380"></a><span class="hs-comment">-- [infer| G !- builtin bi : vTy]</span><span>
</span><a name="line-381"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Builtin"><span class="hs-identifier hs-var">Builtin</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594495"><a href="#local-6989586621679594495"><span class="hs-identifier">bi</span></a></a><span class="hs-special">)</span><span>                            </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOfBuiltin"><span class="hs-identifier hs-var">typeOfBuiltin</span></a><span> </span><a href="#local-6989586621679594495"><span class="hs-identifier hs-var">bi</span></a><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span class="hs-comment">-- [infer| G !- fun : vDom -&gt; vCod]    [check| G !- arg : vDom]</span><span>
</span><a name="line-384"></a><span class="hs-comment">-- ------------------------------------------------------------</span><span>
</span><a name="line-385"></a><span class="hs-comment">-- [infer| G !- fun arg : vCod]</span><span>
</span><a name="line-386"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Apply"><span class="hs-identifier hs-var">Apply</span></a><span> </span><a name="local-6989586621679594496"><a href="#local-6989586621679594496"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679594497"><a href="#local-6989586621679594497"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679594498"><a href="#local-6989586621679594498"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-387"></a><span>    </span><a name="local-6989586621679594499"><a href="#local-6989586621679594499"><span class="hs-identifier">vFunTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679594497"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-388"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Language.PlutusCore.Type.html#getNormalizedType"><span class="hs-identifier hs-var">getNormalizedType</span></a><span> </span><a href="#local-6989586621679594499"><span class="hs-identifier hs-var">vFunTy</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-389"></a><span>        </span><a href="Language.PlutusCore.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594500"><a href="#local-6989586621679594500"><span class="hs-identifier">vDom</span></a></a><span> </span><a name="local-6989586621679594501"><a href="#local-6989586621679594501"><span class="hs-identifier">vCod</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-390"></a><span>            </span><a href="Language.PlutusCore.TypeSynthesis.html#typeCheckM"><span class="hs-identifier hs-var">typeCheckM</span></a><span> </span><a href="#local-6989586621679594496"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679594498"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><a href="#local-6989586621679594500"><span class="hs-identifier hs-var">vDom</span></a><span>  </span><span class="hs-comment">-- Subpart of a normalized type, so normalized.</span><span>
</span><a name="line-391"></a><span>            </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><a href="#local-6989586621679594501"><span class="hs-identifier hs-var">vCod</span></a><span>              </span><span class="hs-comment">-- Subpart of a normalized type, so normalized.</span><span>
</span><a name="line-392"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a><span> </span><a href="#local-6989586621679594496"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594497"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594499"><span class="hs-identifier hs-var">vFunTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-393"></a><span>
</span><a name="line-394"></a><span class="hs-comment">-- [infer| G !- body : all (n :: nK) vCod]    [check| G !- ty :: tyK]    ty ~&gt;? vTy</span><span>
</span><a name="line-395"></a><span class="hs-comment">-- --------------------------------------------------------------------------------</span><span>
</span><a name="line-396"></a><span class="hs-comment">-- [infer| G !- body {ty} : NORM ([vTy / n] vCod)]</span><span>
</span><a name="line-397"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyInst"><span class="hs-identifier hs-var">TyInst</span></a><span> </span><a name="local-6989586621679594502"><a href="#local-6989586621679594502"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679594503"><a href="#local-6989586621679594503"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621679594504"><a href="#local-6989586621679594504"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-398"></a><span>    </span><a name="local-6989586621679594505"><a href="#local-6989586621679594505"><span class="hs-identifier">vBodyTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679594503"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-399"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Language.PlutusCore.Type.html#getNormalizedType"><span class="hs-identifier hs-var">getNormalizedType</span></a><span> </span><a href="#local-6989586621679594505"><span class="hs-identifier hs-var">vBodyTy</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-400"></a><span>        </span><a href="Language.PlutusCore.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594506"><a href="#local-6989586621679594506"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679594507"><a href="#local-6989586621679594507"><span class="hs-identifier">nK</span></a></a><span> </span><a name="local-6989586621679594508"><a href="#local-6989586621679594508"><span class="hs-identifier">vCod</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-401"></a><span>            </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckM"><span class="hs-identifier hs-var">kindCheckM</span></a><span> </span><a href="#local-6989586621679594502"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679594504"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679594507"><span class="hs-identifier hs-var">nK</span></a><span>
</span><a name="line-402"></a><span>            </span><a name="local-6989586621679594509"><a href="#local-6989586621679594509"><span class="hs-identifier">vTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier hs-var">normalizeTypeOptTcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594504"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-403"></a><span>            </span><a href="Language.PlutusCore.TypeSynthesis.html#substituteNormalizeTypeTcm"><span class="hs-identifier hs-var">substituteNormalizeTypeTcm</span></a><span> </span><a href="#local-6989586621679594509"><span class="hs-identifier hs-var">vTy</span></a><span> </span><a href="#local-6989586621679594506"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679594508"><span class="hs-identifier hs-var">vCod</span></a><span>
</span><a name="line-404"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a><span> </span><a href="#local-6989586621679594502"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594503"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyTyName"><span class="hs-identifier hs-var">dummyTyName</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyKind"><span class="hs-identifier hs-var">dummyKind</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594505"><span class="hs-identifier hs-var">vBodyTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-405"></a><span>
</span><a name="line-406"></a><span class="hs-comment">-- [infer| G !- term : ifix vPat vArg]    [infer| G !- vArg :: k]</span><span>
</span><a name="line-407"></a><span class="hs-comment">-- -----------------------------------------------------------------------</span><span>
</span><a name="line-408"></a><span class="hs-comment">-- [infer| G !- unwrap term : NORM (vPat (\(a :: k) -&gt; ifix vPat a) vArg)]</span><span>
</span><a name="line-409"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#Unwrap"><span class="hs-identifier hs-var">Unwrap</span></a><span> </span><a name="local-6989586621679594510"><a href="#local-6989586621679594510"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679594511"><a href="#local-6989586621679594511"><span class="hs-identifier">term</span></a></a><span class="hs-special">)</span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-410"></a><span>    </span><a name="local-6989586621679594512"><a href="#local-6989586621679594512"><span class="hs-identifier">vTermTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679594511"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-411"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Language.PlutusCore.Type.html#getNormalizedType"><span class="hs-identifier hs-var">getNormalizedType</span></a><span> </span><a href="#local-6989586621679594512"><span class="hs-identifier hs-var">vTermTy</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-412"></a><span>        </span><a href="Language.PlutusCore.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679594513"><a href="#local-6989586621679594513"><span class="hs-identifier">vPat</span></a></a><span> </span><a name="local-6989586621679594514"><a href="#local-6989586621679594514"><span class="hs-identifier">vArg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-413"></a><span>            </span><a name="local-6989586621679594515"><a href="#local-6989586621679594515"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679594510"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&lt;$</span><span> </span><a href="#local-6989586621679594514"><span class="hs-identifier hs-var">vArg</span></a><span>
</span><a name="line-414"></a><span>            </span><span class="hs-comment">-- Subparts of a normalized type, so normalized.</span><span>
</span><a name="line-415"></a><span>            </span><a href="Language.PlutusCore.TypeSynthesis.html#unfoldFixOf"><span class="hs-identifier hs-var">unfoldFixOf</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><a href="#local-6989586621679594513"><span class="hs-identifier hs-var">vPat</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-var">NormalizedType</span></a><span> </span><a href="#local-6989586621679594514"><span class="hs-identifier hs-var">vArg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594515"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-416"></a><span>        </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a><span> </span><a href="#local-6989586621679594510"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594511"><span class="hs-identifier hs-var">term</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594512"><span class="hs-identifier hs-var">vTermTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>
</span><a name="line-418"></a><span class="hs-comment">-- [infer| G !- arg :: k]    [check| G !- pat :: (k -&gt; *) -&gt; k -&gt; *]    pat ~&gt;? vPat    arg ~&gt;? vArg</span><span>
</span><a name="line-419"></a><span class="hs-comment">-- [check| G !- term : NORM (vPat (\(a :: k) -&gt; ifix vPat a) vArg)]</span><span>
</span><a name="line-420"></a><span class="hs-comment">-- -------------------------------------------------------------------------------------------------</span><span>
</span><a name="line-421"></a><span class="hs-comment">-- [infer| G !- iwrap pat arg term : ifix vPat vArg]</span><span>
</span><a name="line-422"></a><span class="hs-identifier">typeOf</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#IWrap"><span class="hs-identifier hs-var">IWrap</span></a><span> </span><a name="local-6989586621679594516"><a href="#local-6989586621679594516"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679594517"><a href="#local-6989586621679594517"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679594518"><a href="#local-6989586621679594518"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679594519"><a href="#local-6989586621679594519"><span class="hs-identifier">term</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-423"></a><span>    </span><a name="local-6989586621679594520"><a href="#local-6989586621679594520"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#kindOf"><span class="hs-identifier hs-var">kindOf</span></a><span> </span><a href="#local-6989586621679594518"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-424"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#kindCheckPatternFunctorM"><span class="hs-identifier hs-var">kindCheckPatternFunctorM</span></a><span> </span><a href="#local-6989586621679594516"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679594517"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679594520"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-425"></a><span>    </span><a name="local-6989586621679594521"><a href="#local-6989586621679594521"><span class="hs-identifier">vPat</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier hs-var">normalizeTypeOptTcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594517"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-426"></a><span>    </span><a name="local-6989586621679594522"><a href="#local-6989586621679594522"><span class="hs-identifier">vArg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeOptTcm"><span class="hs-identifier hs-var">normalizeTypeOptTcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594518"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-427"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#typeCheckM"><span class="hs-identifier hs-var">typeCheckM</span></a><span> </span><a href="#local-6989586621679594516"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679594519"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#unfoldFixOf"><span class="hs-identifier hs-var">unfoldFixOf</span></a><span> </span><a href="#local-6989586621679594521"><span class="hs-identifier hs-var">vPat</span></a><span> </span><a href="#local-6989586621679594522"><span class="hs-identifier hs-var">vArg</span></a><span> </span><a href="#local-6989586621679594520"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-428"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679594521"><span class="hs-identifier hs-var">vPat</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679594522"><span class="hs-identifier hs-var">vArg</span></a><span>
</span><a name="line-429"></a><span>
</span><a name="line-430"></a><span class="hs-comment">-- | Check a 'Term' against a 'NormalizedType'.</span><span>
</span><a name="line-431"></a><span class="hs-identifier">typeCheckM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679594377"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><a href="Language.PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><a href="#local-6989586621679594377"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594377"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span class="hs-comment">-- [infer| G !- term : vTermTy]    vTermTy ~ vTy</span><span>
</span><a name="line-434"></a><span class="hs-comment">-- ---------------------------------------------</span><span>
</span><a name="line-435"></a><span class="hs-comment">-- [check| G !- term : vTy]</span><span>
</span><a name="line-436"></a><a name="typeCheckM"><a href="Language.PlutusCore.TypeSynthesis.html#typeCheckM"><span class="hs-identifier">typeCheckM</span></a></a><span> </span><a name="local-6989586621679594523"><a href="#local-6989586621679594523"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679594524"><a href="#local-6989586621679594524"><span class="hs-identifier">term</span></a></a><span> </span><a name="local-6989586621679594525"><a href="#local-6989586621679594525"><span class="hs-identifier">vTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-437"></a><span>    </span><a name="local-6989586621679594526"><a href="#local-6989586621679594526"><span class="hs-identifier">vTermTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a><span> </span><a href="#local-6989586621679594524"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-438"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679594526"><span class="hs-identifier hs-var">vTermTy</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679594525"><span class="hs-identifier hs-var">vTy</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a><span> </span><a href="#local-6989586621679594523"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><a href="#local-6989586621679594524"><span class="hs-identifier hs-var">term</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#getNormalizedType"><span class="hs-identifier hs-var">getNormalizedType</span></a><span> </span><a href="#local-6989586621679594526"><span class="hs-identifier hs-var">vTermTy</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594525"><span class="hs-identifier hs-var">vTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span class="hs-comment">-- | @unfoldFixOf pat arg k = NORM (vPat (\(a :: k) -&gt; ifix vPat a) arg)@</span><span>
</span><a name="line-441"></a><span class="hs-identifier">unfoldFixOf</span><span>
</span><a name="line-442"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ @vPat@</span><span>
</span><a name="line-443"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ @vArg@</span><span>
</span><a name="line-444"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                   </span><span class="hs-comment">-- ^ @k@</span><span>
</span><a name="line-445"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.TypeSynthesis.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a><span> </span><a href="#local-6989586621679594376"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#NormalizedType"><span class="hs-identifier hs-type">NormalizedType</span></a><span> </span><a href="Language.PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-446"></a><a name="unfoldFixOf"><a href="Language.PlutusCore.TypeSynthesis.html#unfoldFixOf"><span class="hs-identifier">unfoldFixOf</span></a></a><span> </span><a name="local-6989586621679594527"><a href="#local-6989586621679594527"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679594528"><a href="#local-6989586621679594528"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679594529"><a href="#local-6989586621679594529"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-447"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679594530"><a href="#local-6989586621679594530"><span class="hs-identifier">vPat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#getNormalizedType"><span class="hs-identifier hs-var">getNormalizedType</span></a><span> </span><a href="#local-6989586621679594527"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-448"></a><span>        </span><a name="local-6989586621679594531"><a href="#local-6989586621679594531"><span class="hs-identifier">vArg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Type.html#getNormalizedType"><span class="hs-identifier hs-var">getNormalizedType</span></a><span> </span><a href="#local-6989586621679594528"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-449"></a><span>    </span><a name="local-6989586621679594532"><a href="#local-6989586621679594532"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Quote.html#freshTyName"><span class="hs-identifier hs-var">freshTyName</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;a&quot;</span><span>
</span><a name="line-450"></a><span>    </span><a href="Language.PlutusCore.TypeSynthesis.html#normalizeTypeTcm"><span class="hs-identifier hs-var">normalizeTypeTcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-451"></a><span>        </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Type.html#TyApp"><span class="hs-identifier hs-var">TyApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594530"><span class="hs-identifier hs-var">vPat</span></a><span>
</span><a name="line-452"></a><span>            </span><span class="hs-special">[</span><span> </span><a href="Language.PlutusCore.Type.html#TyLam"><span class="hs-identifier hs-var">TyLam</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594532"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679594529"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.PlutusCore.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594530"><span class="hs-identifier hs-var">vPat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679594532"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-453"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679594531"><span class="hs-identifier hs-var">vArg</span></a><span>
</span><a name="line-454"></a><span>            </span><span class="hs-special">]</span><span>
</span><a name="line-455"></a></pre></body></html>