<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- | Definition analysis for Plutus Core.</span><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.PlutusCore.Analysis.Definitions</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopeType"><span class="hs-identifier hs-type">ScopeType</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#termDefs"><span class="hs-identifier hs-var">termDefs</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#typeDefs"><span class="hs-identifier hs-var">typeDefs</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#runTermDefs"><span class="hs-identifier hs-var">runTermDefs</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#runTypeDefs"><span class="hs-identifier hs-var">runTypeDefs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Error.html"><span class="hs-identifier">Language.PlutusCore.Error</span></a><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Name.html"><span class="hs-identifier">Language.PlutusCore.Name</span></a><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusCore.Type.html"><span class="hs-identifier">Language.PlutusCore.Type</span></a><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Functor.Foldable</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Lens</span><span>              </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">use</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">uses</span><span class="hs-special">)</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Except</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.State</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Writer</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Coerce</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Foldable</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.IntMap</span><span>               </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IM</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-comment">{- Note [Unique usage errors]
The definitions analysis can find a number of problems with usage of uniques, however
clients may not always want to throw an error on all of them, hence we simply return
them all and allow the client to chose if they want to throw some of them.
-}</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-comment">-- | Information about a unique, a pair of a definition if we have one and a set of uses.</span><span>
</span><a name="line-28"></a><span class="hs-keyword">type</span><span> </span><a name="UniqueInfo"><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfo"><span class="hs-identifier">UniqueInfo</span></a></a><span> </span><a name="local-6989586621679458766"><a href="#local-6989586621679458766"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a><span> </span><a href="#local-6989586621679458766"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Set.Set</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a><span> </span><a href="#local-6989586621679458766"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">type</span><span> </span><a name="UniqueInfos"><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier">UniqueInfos</span></a></a><span> </span><a name="local-6989586621679458765"><a href="#local-6989586621679458765"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">IM.IntMap</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfo"><span class="hs-identifier hs-type">UniqueInfo</span></a><span> </span><a href="#local-6989586621679458765"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-keyword">data</span><span> </span><a name="ScopedLoc"><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier">ScopedLoc</span></a></a><span> </span><a name="local-6989586621679458764"><a href="#local-6989586621679458764"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ScopedLoc"><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier">ScopedLoc</span></a></a><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopeType"><span class="hs-identifier hs-type">ScopeType</span></a><span> </span><a href="#local-6989586621679458764"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-comment">-- | Tag for distinguishing between whether we are talking about the term scope</span><span>
</span><a name="line-34"></a><span class="hs-comment">-- for variables or the type scope for variables.</span><span>
</span><a name="line-35"></a><span class="hs-keyword">data</span><span> </span><a name="ScopeType"><a href="Language.PlutusCore.Analysis.Definitions.html#ScopeType"><span class="hs-identifier">ScopeType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TermScope"><a href="Language.PlutusCore.Analysis.Definitions.html#TermScope"><span class="hs-identifier">TermScope</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="TypeScope"><a href="Language.PlutusCore.Analysis.Definitions.html#TypeScope"><span class="hs-identifier">TypeScope</span></a></a><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-identifier">lookupDef</span><span>
</span><a name="line-38"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679458918"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>        </span><span class="hs-identifier hs-type">MonadState</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a><span> </span><a href="#local-6989586621679458918"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679458919"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.Name.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-41"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458919"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfo"><span class="hs-identifier hs-type">UniqueInfo</span></a><span> </span><a href="#local-6989586621679458918"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-42"></a><a name="lookupDef"><a href="Language.PlutusCore.Analysis.Definitions.html#lookupDef"><span class="hs-identifier">lookupDef</span></a></a><span> </span><a name="local-6989586621679458920"><a href="#local-6989586621679458920"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-43"></a><span>    </span><a name="local-6989586621679458921"><a href="#local-6989586621679458921"><span class="hs-identifier">previousDef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">gets</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">IM.lookup</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unUnique</span><span> </span><a href="#local-6989586621679458920"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679458921"><span class="hs-identifier hs-var">previousDef</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-45"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679458922"><a href="#local-6989586621679458922"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679458922"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-46"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-47"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679458923"><a href="#local-6989586621679458923"><span class="hs-identifier">empty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span>            </span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">IM.insert</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unUnique</span><span> </span><a href="#local-6989586621679458920"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679458923"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-49"></a><span>            </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679458923"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-identifier">addDef</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679458914"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>        </span><a href="Language.PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a><span> </span><a href="#local-6989586621679458915"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679458916"><span class="hs-identifier hs-type">unique</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>        </span><span class="hs-identifier hs-type">MonadState</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a><span> </span><a href="#local-6989586621679458914"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679458917"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>        </span><span class="hs-identifier hs-type">MonadWriter</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a><span> </span><a href="#local-6989586621679458914"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679458917"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679458915"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-comment">-- ^ The variable</span><span>
</span><a name="line-57"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458914"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ The annotation of the variable</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopeType"><span class="hs-identifier hs-type">ScopeType</span></a><span> </span><span class="hs-comment">-- ^ The scope type</span><span>
</span><a name="line-59"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458917"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><a name="addDef"><a href="Language.PlutusCore.Analysis.Definitions.html#addDef"><span class="hs-identifier">addDef</span></a></a><span> </span><a name="local-6989586621679458924"><a href="#local-6989586621679458924"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679458925"><a href="#local-6989586621679458925"><span class="hs-identifier">newDef</span></a></a><span> </span><a name="local-6989586621679458926"><a href="#local-6989586621679458926"><span class="hs-identifier">tpe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679458927"><a href="#local-6989586621679458927"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679458924"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Language.PlutusCore.Name.html#unique"><span class="hs-identifier hs-var">unique</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">coerced</span><span>
</span><a name="line-62"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679458928"><a href="#local-6989586621679458928"><span class="hs-identifier">def</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-var">ScopedLoc</span></a><span> </span><a href="#local-6989586621679458926"><span class="hs-identifier hs-var">tpe</span></a><span> </span><a href="#local-6989586621679458925"><span class="hs-identifier hs-var">newDef</span></a><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span>    </span><a name="local-6989586621679458929"><a href="#local-6989586621679458929"><span class="hs-identifier">d</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679458930"><a href="#local-6989586621679458930"><span class="hs-identifier">uses</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#lookupDef"><span class="hs-identifier hs-var">lookupDef</span></a><span> </span><a href="#local-6989586621679458927"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-65"></a><span>    </span><a href="Language.PlutusCore.Analysis.Definitions.html#checkUndefined"><span class="hs-identifier hs-var">checkUndefined</span></a><span> </span><a href="#local-6989586621679458927"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621679458928"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679458929"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-66"></a><span>    </span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">IM.insert</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unUnique</span><span> </span><a href="#local-6989586621679458927"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679458928"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679458930"><span class="hs-identifier hs-var">uses</span></a><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- | Check that a variable is currently undefined.</span><span>
</span><a name="line-69"></a><span class="hs-identifier">checkUndefined</span><span>
</span><a name="line-70"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadState</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a><span> </span><a href="#local-6989586621679458912"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679458913"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>        </span><span class="hs-identifier hs-type">MonadWriter</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a><span> </span><a href="#local-6989586621679458912"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679458913"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.Name.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-comment">-- ^ The variable</span><span>
</span><a name="line-73"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a><span> </span><a href="#local-6989586621679458912"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ The new definition</span><span>
</span><a name="line-74"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfo"><span class="hs-identifier hs-type">UniqueInfo</span></a><span> </span><a href="#local-6989586621679458912"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ The existing info</span><span>
</span><a name="line-75"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458913"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><a name="checkUndefined"><a href="Language.PlutusCore.Analysis.Definitions.html#checkUndefined"><span class="hs-identifier">checkUndefined</span></a></a><span> </span><a name="local-6989586621679458931"><a href="#local-6989586621679458931"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-var">ScopedLoc</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679458932"><a href="#local-6989586621679458932"><span class="hs-identifier">newDef</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679458933"><a href="#local-6989586621679458933"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679458933"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-var">ScopedLoc</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679458934"><a href="#local-6989586621679458934"><span class="hs-identifier">prevDef</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Error.html#MultiplyDefined"><span class="hs-identifier hs-var">MultiplyDefined</span></a><span> </span><a href="#local-6989586621679458931"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621679458934"><span class="hs-identifier hs-var">prevDef</span></a><span> </span><a href="#local-6989586621679458932"><span class="hs-identifier hs-var">newDef</span></a><span class="hs-special">]</span><span>
</span><a name="line-78"></a><span>    </span><span class="hs-identifier">_</span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-identifier">addUsage</span><span>
</span><a name="line-81"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679458908"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>        </span><a href="Language.PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a><span> </span><a href="#local-6989586621679458909"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679458910"><span class="hs-identifier hs-type">unique</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>        </span><span class="hs-identifier hs-type">MonadState</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a><span> </span><a href="#local-6989586621679458908"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679458911"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>        </span><span class="hs-identifier hs-type">MonadWriter</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a><span> </span><a href="#local-6989586621679458908"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679458911"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679458909"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-comment">-- ^ The variable</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458908"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ The annotation of the variable</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopeType"><span class="hs-identifier hs-type">ScopeType</span></a><span> </span><span class="hs-comment">-- ^ The scope type</span><span>
</span><a name="line-88"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458911"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><a name="addUsage"><a href="Language.PlutusCore.Analysis.Definitions.html#addUsage"><span class="hs-identifier">addUsage</span></a></a><span> </span><a name="local-6989586621679458935"><a href="#local-6989586621679458935"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679458936"><a href="#local-6989586621679458936"><span class="hs-identifier">newUse</span></a></a><span> </span><a name="local-6989586621679458937"><a href="#local-6989586621679458937"><span class="hs-identifier">tpe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679458938"><a href="#local-6989586621679458938"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coerce</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679458935"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Language.PlutusCore.Name.html#unique"><span class="hs-identifier hs-var">unique</span></a><span>
</span><a name="line-91"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679458939"><a href="#local-6989586621679458939"><span class="hs-identifier">use</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-var">ScopedLoc</span></a><span> </span><a href="#local-6989586621679458937"><span class="hs-identifier hs-var">tpe</span></a><span> </span><a href="#local-6989586621679458936"><span class="hs-identifier hs-var">newUse</span></a><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span>    </span><a name="local-6989586621679458940"><a href="#local-6989586621679458940"><span class="hs-identifier">d</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679458941"><a href="#local-6989586621679458941"><span class="hs-identifier">def</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679458942"><a href="#local-6989586621679458942"><span class="hs-identifier">uses</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#lookupDef"><span class="hs-identifier hs-var">lookupDef</span></a><span> </span><a href="#local-6989586621679458938"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-94"></a><span>    </span><a href="Language.PlutusCore.Analysis.Definitions.html#checkCoherency"><span class="hs-identifier hs-var">checkCoherency</span></a><span> </span><a href="#local-6989586621679458938"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621679458939"><span class="hs-identifier hs-var">use</span></a><span> </span><a href="#local-6989586621679458940"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-95"></a><span>    </span><a href="Language.PlutusCore.Analysis.Definitions.html#checkDefined"><span class="hs-identifier hs-var">checkDefined</span></a><span> </span><a href="#local-6989586621679458938"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621679458939"><span class="hs-identifier hs-var">use</span></a><span> </span><a href="#local-6989586621679458940"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>    </span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">IM.insert</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unUnique</span><span> </span><a href="#local-6989586621679458938"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679458941"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Set.insert</span><span> </span><a href="#local-6989586621679458939"><span class="hs-identifier hs-var">use</span></a><span> </span><a href="#local-6989586621679458942"><span class="hs-identifier hs-var">uses</span></a><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-identifier">checkDefined</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadWriter</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a><span> </span><a href="#local-6989586621679458906"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679458907"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.Name.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-comment">-- ^ The unique</span><span>
</span><a name="line-102"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a><span> </span><a href="#local-6989586621679458906"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ The new definition</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfo"><span class="hs-identifier hs-type">UniqueInfo</span></a><span> </span><a href="#local-6989586621679458906"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ The existing info</span><span>
</span><a name="line-104"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458907"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-105"></a><a name="checkDefined"><a href="Language.PlutusCore.Analysis.Definitions.html#checkDefined"><span class="hs-identifier">checkDefined</span></a></a><span> </span><a name="local-6989586621679458943"><a href="#local-6989586621679458943"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-var">ScopedLoc</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679458944"><a href="#local-6989586621679458944"><span class="hs-identifier">loc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679458945"><a href="#local-6989586621679458945"><span class="hs-identifier">def</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679458945"><span class="hs-identifier hs-var">def</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-106"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Error.html#FreeVariable"><span class="hs-identifier hs-var">FreeVariable</span></a><span> </span><a href="#local-6989586621679458943"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621679458944"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">]</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-identifier">checkCoherency</span><span>
</span><a name="line-110"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadWriter</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a><span> </span><a href="#local-6989586621679458904"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679458905"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.Name.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-comment">-- ^ The unique</span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-type">ScopedLoc</span></a><span> </span><a href="#local-6989586621679458904"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ The new definition</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfo"><span class="hs-identifier hs-type">UniqueInfo</span></a><span> </span><a href="#local-6989586621679458904"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ The existing info</span><span>
</span><a name="line-114"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458905"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-115"></a><a name="checkCoherency"><a href="Language.PlutusCore.Analysis.Definitions.html#checkCoherency"><span class="hs-identifier">checkCoherency</span></a></a><span> </span><a name="local-6989586621679458946"><a href="#local-6989586621679458946"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-var">ScopedLoc</span></a><span> </span><a name="local-6989586621679458947"><a href="#local-6989586621679458947"><span class="hs-identifier">tpe</span></a></a><span> </span><a name="local-6989586621679458948"><a href="#local-6989586621679458948"><span class="hs-identifier">loc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679458949"><a href="#local-6989586621679458949"><span class="hs-identifier">def</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679458950"><a href="#local-6989586621679458950"><span class="hs-identifier">uses</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-identifier hs-var">for_</span><span> </span><a href="#local-6989586621679458949"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679458951"><span class="hs-identifier hs-var">checkLoc</span></a><span>
</span><a name="line-117"></a><span>    </span><span class="hs-identifier hs-var">for_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Set.toList</span><span> </span><a href="#local-6989586621679458950"><span class="hs-identifier hs-var">uses</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679458951"><span class="hs-identifier hs-var">checkLoc</span></a><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-120"></a><span>        </span><a name="local-6989586621679458951"><a href="#local-6989586621679458951"><span class="hs-identifier">checkLoc</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#ScopedLoc"><span class="hs-identifier hs-var">ScopedLoc</span></a><span> </span><a name="local-6989586621679458952"><a href="#local-6989586621679458952"><span class="hs-identifier">tpe'</span></a></a><span> </span><a name="local-6989586621679458953"><a href="#local-6989586621679458953"><span class="hs-identifier">loc'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679458952"><span class="hs-identifier hs-var">tpe'</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679458947"><span class="hs-identifier hs-var">tpe</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Error.html#IncoherentUsage"><span class="hs-identifier hs-var">IncoherentUsage</span></a><span> </span><a href="#local-6989586621679458946"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621679458953"><span class="hs-identifier hs-var">loc'</span></a><span> </span><a href="#local-6989586621679458948"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">]</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-identifier">termDefs</span><span>
</span><a name="line-123"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679458900"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span>
</span><a name="line-124"></a><span>        </span><a href="Language.PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679458901"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679458900"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-125"></a><span>        </span><a href="Language.PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679458902"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679458900"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-126"></a><span>        </span><span class="hs-identifier hs-type">MonadState</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a><span> </span><a href="#local-6989586621679458900"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679458903"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span>
</span><a name="line-127"></a><span>        </span><span class="hs-identifier hs-type">MonadWriter</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a><span> </span><a href="#local-6989586621679458900"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679458903"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a><span> </span><a href="#local-6989586621679458902"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679458901"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679458900"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-129"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458903"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><a name="termDefs"><a href="Language.PlutusCore.Analysis.Definitions.html#termDefs"><span class="hs-identifier">termDefs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cata</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-131"></a><span>    </span><a href="Language.PlutusCore.Type.html#VarF"><span class="hs-identifier hs-var">VarF</span></a><span> </span><a name="local-6989586621679458954"><a href="#local-6989586621679458954"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679458955"><a href="#local-6989586621679458955"><span class="hs-identifier">n</span></a></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#addUsage"><span class="hs-identifier hs-var">addUsage</span></a><span> </span><a href="#local-6989586621679458955"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679458954"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#TermScope"><span class="hs-identifier hs-var">TermScope</span></a><span>
</span><a name="line-132"></a><span>    </span><a href="Language.PlutusCore.Type.html#LamAbsF"><span class="hs-identifier hs-var">LamAbsF</span></a><span> </span><a name="local-6989586621679458956"><a href="#local-6989586621679458956"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679458957"><a href="#local-6989586621679458957"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679458958"><a href="#local-6989586621679458958"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679458959"><a href="#local-6989586621679458959"><span class="hs-identifier">t</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#addDef"><span class="hs-identifier hs-var">addDef</span></a><span> </span><a href="#local-6989586621679458957"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679458956"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#TermScope"><span class="hs-identifier hs-var">TermScope</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#typeDefs"><span class="hs-identifier hs-var">typeDefs</span></a><span> </span><a href="#local-6989586621679458958"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621679458959"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-133"></a><span>    </span><a href="Language.PlutusCore.Type.html#IWrapF"><span class="hs-identifier hs-var">IWrapF</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679458960"><a href="#local-6989586621679458960"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679458961"><a href="#local-6989586621679458961"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679458962"><a href="#local-6989586621679458962"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#typeDefs"><span class="hs-identifier hs-var">typeDefs</span></a><span> </span><a href="#local-6989586621679458960"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#typeDefs"><span class="hs-identifier hs-var">typeDefs</span></a><span> </span><a href="#local-6989586621679458961"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621679458962"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-134"></a><span>    </span><a href="Language.PlutusCore.Type.html#TyAbsF"><span class="hs-identifier hs-var">TyAbsF</span></a><span> </span><a name="local-6989586621679458963"><a href="#local-6989586621679458963"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679458964"><a href="#local-6989586621679458964"><span class="hs-identifier">tn</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679458965"><a href="#local-6989586621679458965"><span class="hs-identifier">t</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#addDef"><span class="hs-identifier hs-var">addDef</span></a><span> </span><a href="#local-6989586621679458964"><span class="hs-identifier hs-var">tn</span></a><span> </span><a href="#local-6989586621679458963"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#TypeScope"><span class="hs-identifier hs-var">TypeScope</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621679458965"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-135"></a><span>    </span><a href="Language.PlutusCore.Type.html#TyInstF"><span class="hs-identifier hs-var">TyInstF</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679458966"><a href="#local-6989586621679458966"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679458967"><a href="#local-6989586621679458967"><span class="hs-identifier">ty</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458966"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#typeDefs"><span class="hs-identifier hs-var">typeDefs</span></a><span> </span><a href="#local-6989586621679458967"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-136"></a><span>    </span><a name="local-6989586621679458968"><a href="#local-6989586621679458968"><span class="hs-identifier">x</span></a></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sequence_</span><span> </span><a href="#local-6989586621679458968"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-identifier">typeDefs</span><span>
</span><a name="line-139"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679458774"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span>
</span><a name="line-140"></a><span>        </span><a href="Language.PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679458775"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679458774"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-141"></a><span>        </span><span class="hs-identifier hs-type">MonadState</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a><span> </span><a href="#local-6989586621679458774"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679458776"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span>
</span><a name="line-142"></a><span>        </span><span class="hs-identifier hs-type">MonadWriter</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a><span> </span><a href="#local-6989586621679458774"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679458776"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="#local-6989586621679458775"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679458774"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-144"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458776"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-145"></a><a name="typeDefs"><a href="Language.PlutusCore.Analysis.Definitions.html#typeDefs"><span class="hs-identifier">typeDefs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cata</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-146"></a><span>    </span><a href="Language.PlutusCore.Type.html#TyVarF"><span class="hs-identifier hs-var">TyVarF</span></a><span> </span><a name="local-6989586621679458969"><a href="#local-6989586621679458969"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679458970"><a href="#local-6989586621679458970"><span class="hs-identifier">n</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#addUsage"><span class="hs-identifier hs-var">addUsage</span></a><span> </span><a href="#local-6989586621679458970"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679458969"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#TypeScope"><span class="hs-identifier hs-var">TypeScope</span></a><span>
</span><a name="line-147"></a><span>    </span><a href="Language.PlutusCore.Type.html#TyForallF"><span class="hs-identifier hs-var">TyForallF</span></a><span> </span><a name="local-6989586621679458971"><a href="#local-6989586621679458971"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679458972"><a href="#local-6989586621679458972"><span class="hs-identifier">tn</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679458973"><a href="#local-6989586621679458973"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#addDef"><span class="hs-identifier hs-var">addDef</span></a><span> </span><a href="#local-6989586621679458972"><span class="hs-identifier hs-var">tn</span></a><span> </span><a href="#local-6989586621679458971"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#TypeScope"><span class="hs-identifier hs-var">TypeScope</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621679458973"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-148"></a><span>    </span><a href="Language.PlutusCore.Type.html#TyLamF"><span class="hs-identifier hs-var">TyLamF</span></a><span> </span><a name="local-6989586621679458974"><a href="#local-6989586621679458974"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679458975"><a href="#local-6989586621679458975"><span class="hs-identifier">tn</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679458976"><a href="#local-6989586621679458976"><span class="hs-identifier">t</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#addDef"><span class="hs-identifier hs-var">addDef</span></a><span> </span><a href="#local-6989586621679458975"><span class="hs-identifier hs-var">tn</span></a><span> </span><a href="#local-6989586621679458974"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#TypeScope"><span class="hs-identifier hs-var">TypeScope</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621679458976"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-149"></a><span>    </span><a name="local-6989586621679458977"><a href="#local-6989586621679458977"><span class="hs-identifier">x</span></a></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sequence_</span><span> </span><a href="#local-6989586621679458977"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-identifier">runTermDefs</span><span>
</span><a name="line-152"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679458770"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span>
</span><a name="line-153"></a><span>        </span><a href="Language.PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679458771"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679458770"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-154"></a><span>        </span><a href="Language.PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679458772"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679458770"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-155"></a><span>        </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679458773"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a><span> </span><a href="#local-6989586621679458772"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679458771"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679458770"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-157"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458773"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a><span> </span><a href="#local-6989586621679458770"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a><span> </span><a href="#local-6989586621679458770"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><a name="runTermDefs"><a href="Language.PlutusCore.Analysis.Definitions.html#runTermDefs"><span class="hs-identifier">runTermDefs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runWriterT</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">execStateT</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#termDefs"><span class="hs-identifier hs-var">termDefs</span></a><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-identifier">runTypeDefs</span><span>
</span><a name="line-161"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679458767"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span>
</span><a name="line-162"></a><span>        </span><a href="Language.PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679458768"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679458767"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="Language.PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-163"></a><span>        </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679458769"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusCore.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="#local-6989586621679458768"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679458767"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-165"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679458769"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Analysis.Definitions.html#UniqueInfos"><span class="hs-identifier hs-type">UniqueInfos</span></a><span> </span><a href="#local-6989586621679458767"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Error.html#UniqueError"><span class="hs-identifier hs-type">UniqueError</span></a><span> </span><a href="#local-6989586621679458767"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-166"></a><a name="runTypeDefs"><a href="Language.PlutusCore.Analysis.Definitions.html#runTypeDefs"><span class="hs-identifier">runTypeDefs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runWriterT</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">execStateT</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.PlutusCore.Analysis.Definitions.html#typeDefs"><span class="hs-identifier hs-var">typeDefs</span></a><span>
</span><a name="line-167"></a></pre></body></html>