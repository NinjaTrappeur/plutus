<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase       #-}</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- | Functions for computing variable usage inside terms and types.</span><span>
</span><a name="line-4"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.PlutusIR.Analysis.Usages</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusIR.Analysis.Usages.html#runTermUsages"><span class="hs-identifier hs-var">runTermUsages</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#runTypeUsages"><span class="hs-identifier hs-var">runTypeUsages</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#isUsed"><span class="hs-identifier hs-var">isUsed</span></a><span class="hs-special">,</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#allUsed"><span class="hs-identifier hs-var">allUsed</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span>           </span><a href="Language.PlutusIR.html"><span class="hs-identifier">Language.PlutusIR</span></a><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusCore</span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PLC</span><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusCore.Name</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PLC</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Lens</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.State</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Coerce</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Foldable</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span>                 </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span>                 </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-comment">-- | Variable uses, as a map from the 'PLC.Unique' to its usage count. Unused variables may be missing</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- or have usage count 0.</span><span>
</span><a name="line-21"></a><span class="hs-keyword">type</span><span> </span><a name="Usages"><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier">Usages</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><span class="hs-identifier hs-type">PLC.Unique</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-identifier">addUsage</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PLC.HasUnique</span><span> </span><a href="#local-6989586621679166919"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679166920"><span class="hs-identifier hs-type">unique</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679166919"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages</span></a><span>
</span><a name="line-24"></a><a name="addUsage"><a href="Language.PlutusIR.Analysis.Usages.html#addUsage"><span class="hs-identifier">addUsage</span></a></a><span> </span><a name="local-6989586621679166921"><a href="#local-6989586621679166921"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679166922"><a href="#local-6989586621679166922"><span class="hs-identifier">usages</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-25"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-26"></a><span>        </span><a name="local-6989586621679166923"><a href="#local-6989586621679166923"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coerce</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679166921"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><span class="hs-identifier hs-var">PLC.unique</span><span>
</span><a name="line-27"></a><span>        </span><a name="local-6989586621679166924"><a href="#local-6989586621679166924"><span class="hs-identifier">old</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.findWithDefault</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679166923"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621679166922"><span class="hs-identifier hs-var">usages</span></a><span>
</span><a name="line-28"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">Map.insert</span><span> </span><a href="#local-6989586621679166923"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679166924"><span class="hs-identifier hs-var">old</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679166922"><span class="hs-identifier hs-var">usages</span></a><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-identifier">isUsed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PLC.HasUnique</span><span> </span><a href="#local-6989586621679166917"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679166918"><span class="hs-identifier hs-type">unique</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679166917"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-31"></a><a name="isUsed"><a href="Language.PlutusIR.Analysis.Usages.html#isUsed"><span class="hs-identifier">isUsed</span></a></a><span> </span><a name="local-6989586621679167029"><a href="#local-6989586621679167029"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679167030"><a href="#local-6989586621679167030"><span class="hs-identifier">usages</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.findWithDefault</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679167029"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><span class="hs-identifier hs-var">PLC.unique</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">coerced</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679167030"><span class="hs-identifier hs-var">usages</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-identifier">allUsed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Set.Set</span><span> </span><span class="hs-identifier hs-type">PLC.Unique</span><span>
</span><a name="line-34"></a><a name="allUsed"><a href="Language.PlutusIR.Analysis.Usages.html#allUsed"><span class="hs-identifier">allUsed</span></a></a><span> </span><a name="local-6989586621679167189"><a href="#local-6989586621679167189"><span class="hs-identifier">usages</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.keysSet</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Map.filter</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679167189"><span class="hs-identifier hs-var">usages</span></a><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-comment">-- | Compute the 'Usages' for a 'Term'.</span><span>
</span><a name="line-37"></a><span class="hs-identifier">runTermUsages</span><span>
</span><a name="line-38"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PLC.HasUnique</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679166914"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679166915"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">PLC.TermUnique</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">PLC.HasUnique</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679166916"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166915"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">PLC.TypeUnique</span><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusIR.html#Term"><span class="hs-identifier hs-type">Term</span></a><span> </span><a href="#local-6989586621679166916"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166914"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679166915"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-40"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages</span></a><span>
</span><a name="line-41"></a><a name="runTermUsages"><a href="Language.PlutusIR.Analysis.Usages.html#runTermUsages"><span class="hs-identifier">runTermUsages</span></a></a><span> </span><a name="local-6989586621679167190"><a href="#local-6989586621679167190"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">execState</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusIR.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">termUsages</span></a><span> </span><a href="#local-6989586621679167190"><span class="hs-identifier hs-var">term</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">-- | Compute the 'Usages' for a 'Type'.</span><span>
</span><a name="line-44"></a><span class="hs-identifier">runTypeUsages</span><span>
</span><a name="line-45"></a><span>    </span><span class="hs-glyph">::</span><span class="hs-special">(</span><span class="hs-identifier hs-type">PLC.HasUnique</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679166912"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166913"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">PLC.TypeUnique</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><a href="#local-6989586621679166912"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166913"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-47"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages</span></a><span>
</span><a name="line-48"></a><a name="runTypeUsages"><a href="Language.PlutusIR.Analysis.Usages.html#runTypeUsages"><span class="hs-identifier">runTypeUsages</span></a></a><span> </span><a name="local-6989586621679167303"><a href="#local-6989586621679167303"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">execState</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167303"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-identifier">termUsages</span><span>
</span><a name="line-51"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadState</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages</span></a><span> </span><a href="#local-6989586621679166908"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">PLC.HasUnique</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679166909"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679166910"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">PLC.TermUnique</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">PLC.HasUnique</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679166911"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166910"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">PLC.TypeUnique</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusIR.html#Term"><span class="hs-identifier hs-type">Term</span></a><span> </span><a href="#local-6989586621679166911"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166909"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679166910"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-53"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679166908"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><a name="termUsages"><a href="Language.PlutusIR.Analysis.Usages.html#termUsages"><span class="hs-identifier">termUsages</span></a></a><span> </span><a name="local-6989586621679167304"><a href="#local-6989586621679167304"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679167304"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-55"></a><span>    </span><a href="Language.PlutusIR.html#Let"><span class="hs-identifier hs-var">Let</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167305"><a href="#local-6989586621679167305"><span class="hs-identifier">bs</span></a></a><span> </span><a name="local-6989586621679167306"><a href="#local-6989586621679167306"><span class="hs-identifier">t</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">traverse_</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#bindingUsages"><span class="hs-identifier hs-var">bindingUsages</span></a><span> </span><a href="#local-6989586621679167305"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">termUsages</span></a><span> </span><a href="#local-6989586621679167306"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-56"></a><span>    </span><a href="Language.PlutusIR.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167307"><a href="#local-6989586621679167307"><span class="hs-identifier">n</span></a></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusIR.Analysis.Usages.html#addUsage"><span class="hs-identifier hs-var">addUsage</span></a><span> </span><a href="#local-6989586621679167307"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span>    </span><a href="Language.PlutusIR.html#TyAbs"><span class="hs-identifier hs-var">TyAbs</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167308"><a href="#local-6989586621679167308"><span class="hs-identifier">t</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">termUsages</span></a><span> </span><a href="#local-6989586621679167308"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-58"></a><span>    </span><a href="Language.PlutusIR.html#LamAbs"><span class="hs-identifier hs-var">LamAbs</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167309"><a href="#local-6989586621679167309"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679167310"><a href="#local-6989586621679167310"><span class="hs-identifier">t</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167309"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">termUsages</span></a><span> </span><a href="#local-6989586621679167310"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-59"></a><span>    </span><a href="Language.PlutusIR.html#Apply"><span class="hs-identifier hs-var">Apply</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167311"><a href="#local-6989586621679167311"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679167312"><a href="#local-6989586621679167312"><span class="hs-identifier">t2</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">termUsages</span></a><span> </span><a href="#local-6989586621679167311"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">termUsages</span></a><span> </span><a href="#local-6989586621679167312"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-60"></a><span>    </span><a href="Language.PlutusIR.html#TyInst"><span class="hs-identifier hs-var">TyInst</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167313"><a href="#local-6989586621679167313"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679167314"><a href="#local-6989586621679167314"><span class="hs-identifier">ty</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">termUsages</span></a><span> </span><a href="#local-6989586621679167313"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167314"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-61"></a><span>    </span><a href="Language.PlutusIR.html#Error"><span class="hs-identifier hs-var">Error</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167315"><a href="#local-6989586621679167315"><span class="hs-identifier">ty</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167315"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-62"></a><span>    </span><a href="Language.PlutusIR.html#IWrap"><span class="hs-identifier hs-var">IWrap</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167316"><a href="#local-6989586621679167316"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679167317"><a href="#local-6989586621679167317"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679167318"><a href="#local-6989586621679167318"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167316"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167317"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">termUsages</span></a><span> </span><a href="#local-6989586621679167318"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-63"></a><span>    </span><a href="Language.PlutusIR.html#Unwrap"><span class="hs-identifier hs-var">Unwrap</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167319"><a href="#local-6989586621679167319"><span class="hs-identifier">t</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">termUsages</span></a><span> </span><a href="#local-6989586621679167319"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-64"></a><span>    </span><a href="Language.PlutusIR.html#Constant"><span class="hs-identifier hs-var">Constant</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>    </span><a href="Language.PlutusIR.html#Builtin"><span class="hs-identifier hs-var">Builtin</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-identifier">varDeclUsages</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadState</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages</span></a><span> </span><a href="#local-6989586621679166904"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">PLC.HasUnique</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679166905"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166906"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">PLC.TypeUnique</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">VarDecl</span><span> </span><a href="#local-6989586621679166905"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166907"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679166906"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-70"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679166904"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><a name="varDeclUsages"><a href="Language.PlutusIR.Analysis.Usages.html#varDeclUsages"><span class="hs-identifier">varDeclUsages</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarDecl</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167320"><a href="#local-6989586621679167320"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167320"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- Here for completeness but doesn't do much. Would matter if we had kind variables we had to check for.</span><span>
</span><a name="line-74"></a><span class="hs-identifier">tyVarDeclUsages</span><span>
</span><a name="line-75"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadState</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages</span></a><span> </span><a href="#local-6989586621679166901"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">TyVarDecl</span><span> </span><a href="#local-6989586621679166902"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166903"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-77"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679166901"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><a name="tyVarDeclUsages"><a href="Language.PlutusIR.Analysis.Usages.html#tyVarDeclUsages"><span class="hs-identifier">tyVarDeclUsages</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-identifier">bindingUsages</span><span>
</span><a name="line-81"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadState</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages</span></a><span> </span><a href="#local-6989586621679166897"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">PLC.HasUnique</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679166898"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679166899"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">PLC.TermUnique</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">PLC.HasUnique</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679166900"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166899"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">PLC.TypeUnique</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.PlutusIR.html#Binding"><span class="hs-identifier hs-type">Binding</span></a><span> </span><a href="#local-6989586621679166900"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166898"><span class="hs-identifier hs-type">name</span></a><span> </span><a href="#local-6989586621679166899"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-83"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679166897"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><a name="bindingUsages"><a href="Language.PlutusIR.Analysis.Usages.html#bindingUsages"><span class="hs-identifier">bindingUsages</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-85"></a><span>    </span><a href="Language.PlutusIR.html#TermBind"><span class="hs-identifier hs-var">TermBind</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167321"><a href="#local-6989586621679167321"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">termUsages</span></a><span> </span><a href="#local-6989586621679167321"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-86"></a><span>    </span><a href="Language.PlutusIR.html#TypeBind"><span class="hs-identifier hs-var">TypeBind</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167322"><a href="#local-6989586621679167322"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167322"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-87"></a><span>    </span><a href="Language.PlutusIR.html#DatatypeBind"><span class="hs-identifier hs-var">DatatypeBind</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusIR.html#Datatype"><span class="hs-identifier hs-var">Datatype</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167323"><a href="#local-6989586621679167323"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-6989586621679167324"><a href="#local-6989586621679167324"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167325"><a href="#local-6989586621679167325"><span class="hs-identifier">constrs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-88"></a><span>        </span><a href="Language.PlutusIR.Analysis.Usages.html#tyVarDeclUsages"><span class="hs-identifier hs-var">tyVarDeclUsages</span></a><span> </span><a href="#local-6989586621679167323"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-89"></a><span>        </span><span class="hs-identifier hs-var">traverse_</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#tyVarDeclUsages"><span class="hs-identifier hs-var">tyVarDeclUsages</span></a><span> </span><a href="#local-6989586621679167324"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-90"></a><span>        </span><span class="hs-identifier hs-var">traverse_</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#varDeclUsages"><span class="hs-identifier hs-var">varDeclUsages</span></a><span> </span><a href="#local-6989586621679167325"><span class="hs-identifier hs-var">constrs</span></a><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">-- TODO: move to language-plutus-core</span><span>
</span><a name="line-93"></a><span class="hs-identifier">typeUsages</span><span>
</span><a name="line-94"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadState</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages</span></a><span> </span><a href="#local-6989586621679166773"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">PLC.HasUnique</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679166774"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166775"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">PLC.TypeUnique</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><a href="#local-6989586621679166774"><span class="hs-identifier hs-type">tyname</span></a><span> </span><a href="#local-6989586621679166775"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-96"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679166773"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-97"></a><a name="typeUsages"><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier">typeUsages</span></a></a><span> </span><a name="local-6989586621679167326"><a href="#local-6989586621679167326"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679167326"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-98"></a><span>    </span><span class="hs-identifier hs-var">TyVar</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167327"><a href="#local-6989586621679167327"><span class="hs-identifier">n</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusIR.Analysis.Usages.html#addUsage"><span class="hs-identifier hs-var">addUsage</span></a><span> </span><a href="#local-6989586621679167327"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-identifier hs-var">TyFun</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167328"><a href="#local-6989586621679167328"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679167329"><a href="#local-6989586621679167329"><span class="hs-identifier">t2</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167328"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167329"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-100"></a><span>    </span><span class="hs-identifier hs-var">TyIFix</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167330"><a href="#local-6989586621679167330"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679167331"><a href="#local-6989586621679167331"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167330"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167331"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-101"></a><span>    </span><span class="hs-identifier hs-var">TyForall</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167332"><a href="#local-6989586621679167332"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167332"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-102"></a><span>    </span><span class="hs-identifier hs-var">TyLam</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167333"><a href="#local-6989586621679167333"><span class="hs-identifier">t</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167333"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-103"></a><span>    </span><span class="hs-identifier hs-var">TyApp</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679167334"><a href="#local-6989586621679167334"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679167335"><a href="#local-6989586621679167335"><span class="hs-identifier">t2</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167334"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Language.PlutusIR.Analysis.Usages.html#typeUsages"><span class="hs-identifier hs-var">typeUsages</span></a><span> </span><a href="#local-6989586621679167335"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-104"></a><span>    </span><span class="hs-identifier hs-var">TyBuiltin</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-identifier hs-var">TyInt</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-106"></a></pre></body></html>