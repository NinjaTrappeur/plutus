<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | The CEK machine.</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- Rules are the same as for the CK machine from &quot;Language.PlutusCore.Evaluation.CkMachine&quot;,</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- except we do not use substitution and use environments instead.</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- The CEK machine relies on variables having non-equal 'Unique's whenever they have non-equal</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- string names. I.e. 'Unique's are used instead of string names. This is for efficiency reasons.</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- The type checker pass is a prerequisite.</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Feeding ill-typed terms to the CEK machine will likely result in a 'MachineException'.</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- The CEK machine generates booleans along the way which might contain globally non-unique 'Unique's.</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- This is not a problem as the CEK machines handles name capture by design.</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Dynamic extensions to the set of built-ins are allowed.</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- In case an unknown dynamic built-in is encountered, an 'UnknownDynamicBuiltinNameError' is returned</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- (wrapped in 'OtherMachineError').</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.PlutusCore.Interpreter.CekMachine</span><span>
</span><a name="line-17"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekMachineException"><span class="hs-identifier hs-type">CekMachineException</span></a><span>
</span><a name="line-18"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">EvaluationResultF</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvaluationSuccess</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">EvaluationFailure</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">EvaluationResult</span><span>
</span><a name="line-20"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateCekCatch"><span class="hs-identifier hs-var">evaluateCekCatch</span></a><span>
</span><a name="line-21"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateCek"><span class="hs-identifier hs-var">evaluateCek</span></a><span>
</span><a name="line-22"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#readDynamicBuiltinCek"><span class="hs-identifier hs-var">readDynamicBuiltinCek</span></a><span>
</span><a name="line-23"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#runCek"><span class="hs-identifier hs-var">runCek</span></a><span>
</span><a name="line-24"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.PlutusCore</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.PlutusCore.Constant</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.PlutusCore.Evaluation.MachineException</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.PlutusCore.View</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">PlutusPrelude</span><span>                                   </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hoist</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Lens.TH</span><span>                                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">makeLenses</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Except</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Morph</span><span>                             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hoist</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Reader</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Trans</span><span>                             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lift</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.IntMap</span><span>                                     </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.IntMap</span><span>                                     </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IntMap</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span>                                        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-keyword">type</span><span> </span><a name="Plain"><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier">Plain</span></a></a><span> </span><a name="local-6989586621679044163"><a href="#local-6989586621679044163"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679044163"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-identifier hs-type">TyName</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">-- | The CEK machine-specific 'MachineException'.</span><span>
</span><a name="line-44"></a><span class="hs-keyword">type</span><span> </span><a name="CekMachineException"><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekMachineException"><span class="hs-identifier">CekMachineException</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">MachineException</span><span> </span><span class="hs-identifier hs-type">UnknownDynamicBuiltinNameError</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-comment">-- | A 'Value' packed together with the environment it's defined in.</span><span>
</span><a name="line-47"></a><span class="hs-keyword">data</span><span> </span><a name="Closure"><a href="Language.PlutusCore.Interpreter.CekMachine.html#Closure"><span class="hs-identifier">Closure</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Closure"><a href="Language.PlutusCore.Interpreter.CekMachine.html#Closure"><span class="hs-identifier">Closure</span></a></a><span>
</span><a name="line-48"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="_closureVarEnv"><a href="Language.PlutusCore.Interpreter.CekMachine.html#_closureVarEnv"><span class="hs-identifier">_closureVarEnv</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span>
</span><a name="line-49"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_closureValue"><a href="Language.PlutusCore.Interpreter.CekMachine.html#_closureValue"><span class="hs-identifier">_closureValue</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier hs-type">Plain</span></a><span> </span><span class="hs-identifier hs-type">Value</span><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-comment">-- | Variable environments used by the CEK machine.</span><span>
</span><a name="line-53"></a><span class="hs-comment">-- Each row is a mapping from the 'Unique' representing a variable to a 'Closure'.</span><span>
</span><a name="line-54"></a><span class="hs-keyword">newtype</span><span> </span><a name="VarEnv"><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier">VarEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="VarEnv"><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier">VarEnv</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Closure"><span class="hs-identifier hs-type">Closure</span></a><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">-- | The environment the CEK machine runs in.</span><span>
</span><a name="line-57"></a><span class="hs-keyword">data</span><span> </span><a name="CekEnv"><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekEnv"><span class="hs-identifier">CekEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CekEnv"><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekEnv"><span class="hs-identifier">CekEnv</span></a></a><span>
</span><a name="line-58"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="_cekEnvMeans"><a href="Language.PlutusCore.Interpreter.CekMachine.html#_cekEnvMeans"><span class="hs-identifier">_cekEnvMeans</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynamicBuiltinNameMeanings</span><span>
</span><a name="line-59"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_cekEnvVarEnv"><a href="Language.PlutusCore.Interpreter.CekMachine.html#_cekEnvVarEnv"><span class="hs-identifier">_cekEnvVarEnv</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span>
</span><a name="line-60"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-comment">-- | The monad the CEK machine runs in.</span><span>
</span><a name="line-63"></a><span class="hs-keyword">type</span><span> </span><a name="CekM"><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier">CekM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">ReaderT</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekEnv"><span class="hs-identifier hs-type">CekEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekMachineException"><span class="hs-identifier hs-type">CekMachineException</span></a><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">data</span><span> </span><a name="Frame"><a href="Language.PlutusCore.Interpreter.CekMachine.html#Frame"><span class="hs-identifier">Frame</span></a></a><span>
</span><a name="line-66"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="FrameApplyFun"><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameApplyFun"><span class="hs-identifier">FrameApplyFun</span></a></a><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier hs-type">Plain</span></a><span> </span><span class="hs-identifier hs-type">Value</span><span class="hs-special">)</span><span>               </span><span class="hs-comment">-- ^ @[V _]@</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="FrameApplyArg"><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameApplyArg"><span class="hs-identifier">FrameApplyArg</span></a></a><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier hs-type">Plain</span></a><span> </span><span class="hs-identifier hs-type">Term</span><span class="hs-special">)</span><span>                </span><span class="hs-comment">-- ^ @[_ N]@</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="FrameTyInstArg"><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameTyInstArg"><span class="hs-identifier">FrameTyInstArg</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-identifier hs-type">TyName</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>                  </span><span class="hs-comment">-- ^ @{_ A}@</span><span>
</span><a name="line-69"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="FrameUnwrap"><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameUnwrap"><span class="hs-identifier">FrameUnwrap</span></a></a><span>                                      </span><span class="hs-comment">-- ^ @(unwrap _)@</span><span>
</span><a name="line-70"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="FrameIWrap"><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameIWrap"><span class="hs-identifier">FrameIWrap</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-identifier hs-type">TyName</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-identifier hs-type">TyName</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ @(iwrap A B _)@</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-keyword">type</span><span> </span><a name="Context"><a href="Language.PlutusCore.Interpreter.CekMachine.html#Context"><span class="hs-identifier">Context</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Frame"><span class="hs-identifier hs-type">Frame</span></a><span class="hs-special">]</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-identifier hs-var">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">CekEnv</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-identifier">runCekM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekEnv"><span class="hs-identifier hs-type">CekEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier hs-type">CekM</span></a><span> </span><a href="#local-6989586621679059013"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekMachineException"><span class="hs-identifier hs-type">CekMachineException</span></a><span> </span><a href="#local-6989586621679059013"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-77"></a><a name="runCekM"><a href="Language.PlutusCore.Interpreter.CekMachine.html#runCekM"><span class="hs-identifier">runCekM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier">runReaderT</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">-- | Get the current 'VarEnv'.</span><span>
</span><a name="line-80"></a><span class="hs-identifier">getVarEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier hs-type">CekM</span></a><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span>
</span><a name="line-81"></a><a name="getVarEnv"><a href="Language.PlutusCore.Interpreter.CekMachine.html#getVarEnv"><span class="hs-identifier">getVarEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-identifier">_cekEnvVarEnv</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-comment">-- | Set a new 'VarEnv' and proceed.</span><span>
</span><a name="line-84"></a><span class="hs-identifier">withVarEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier hs-type">CekM</span></a><span> </span><a href="#local-6989586621679059012"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier hs-type">CekM</span></a><span> </span><a href="#local-6989586621679059012"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-85"></a><a name="withVarEnv"><a href="Language.PlutusCore.Interpreter.CekMachine.html#withVarEnv"><span class="hs-identifier">withVarEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">local</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">set</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#cekEnvVarEnv"><span class="hs-identifier hs-var">cekEnvVarEnv</span></a><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-comment">-- | Extend an environment with a variable name, the value the variable stands for</span><span>
</span><a name="line-88"></a><span class="hs-comment">-- and the environment the value is defined in.</span><span>
</span><a name="line-89"></a><span class="hs-identifier">extendVarEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier hs-type">Plain</span></a><span> </span><span class="hs-identifier hs-type">Value</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span>
</span><a name="line-90"></a><a name="extendVarEnv"><a href="Language.PlutusCore.Interpreter.CekMachine.html#extendVarEnv"><span class="hs-identifier">extendVarEnv</span></a></a><span> </span><a name="local-6989586621679059321"><a href="#local-6989586621679059321"><span class="hs-identifier">argName</span></a></a><span> </span><a name="local-6989586621679059322"><a href="#local-6989586621679059322"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679059323"><a href="#local-6989586621679059323"><span class="hs-identifier">argVarEnv</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-var">VarEnv</span></a><span> </span><a name="local-6989586621679059324"><a href="#local-6989586621679059324"><span class="hs-identifier">oldVarEnv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-91"></a><span>    </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-var">VarEnv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">IntMap.insert</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unUnique</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nameUnique</span><span> </span><a href="#local-6989586621679059321"><span class="hs-identifier hs-var">argName</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Closure"><span class="hs-identifier hs-var">Closure</span></a><span> </span><a href="#local-6989586621679059323"><span class="hs-identifier hs-var">argVarEnv</span></a><span> </span><a href="#local-6989586621679059322"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059324"><span class="hs-identifier hs-var">oldVarEnv</span></a><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-comment">-- | Look up a variable name in the environment.</span><span>
</span><a name="line-94"></a><span class="hs-identifier">lookupVarName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier hs-type">CekM</span></a><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Closure"><span class="hs-identifier hs-type">Closure</span></a><span>
</span><a name="line-95"></a><a name="lookupVarName"><a href="Language.PlutusCore.Interpreter.CekMachine.html#lookupVarName"><span class="hs-identifier">lookupVarName</span></a></a><span> </span><a name="local-6989586621679059325"><a href="#local-6989586621679059325"><span class="hs-identifier">varName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-96"></a><span>    </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-var">VarEnv</span></a><span> </span><a name="local-6989586621679059326"><a href="#local-6989586621679059326"><span class="hs-identifier">varEnv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#getVarEnv"><span class="hs-identifier hs-var">getVarEnv</span></a><span>
</span><a name="line-97"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">IntMap.lookup</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unUnique</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nameUnique</span><span> </span><a href="#local-6989586621679059325"><span class="hs-identifier hs-var">varName</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059326"><span class="hs-identifier hs-var">varEnv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-98"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">MachineException</span><span> </span><span class="hs-identifier hs-var">OpenTermEvaluatedMachineError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Var</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059325"><span class="hs-identifier hs-var">varName</span></a><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679059445"><a href="#local-6989586621679059445"><span class="hs-identifier">clos</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679059445"><span class="hs-identifier hs-var">clos</span></a><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-comment">-- | Look up a 'DynamicBuiltinName' in the environment.</span><span>
</span><a name="line-102"></a><span class="hs-identifier">lookupDynamicBuiltinName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynamicBuiltinName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier hs-type">CekM</span></a><span> </span><span class="hs-identifier hs-type">DynamicBuiltinNameMeaning</span><span>
</span><a name="line-103"></a><a name="lookupDynamicBuiltinName"><a href="Language.PlutusCore.Interpreter.CekMachine.html#lookupDynamicBuiltinName"><span class="hs-identifier">lookupDynamicBuiltinName</span></a></a><span> </span><a name="local-6989586621679059446"><a href="#local-6989586621679059446"><span class="hs-identifier">dynName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-104"></a><span>    </span><span class="hs-identifier hs-var">DynamicBuiltinNameMeanings</span><span> </span><a name="local-6989586621679059447"><a href="#local-6989586621679059447"><span class="hs-identifier">means</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-identifier">_cekEnvMeans</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621679059446"><span class="hs-identifier hs-var">dynName</span></a><span> </span><a href="#local-6989586621679059447"><span class="hs-identifier hs-var">means</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-106"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">MachineException</span><span> </span><a href="#local-6989586621679059448"><span class="hs-identifier hs-var">err</span></a><span> </span><a href="#local-6989586621679059449"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-107"></a><span>            </span><a name="local-6989586621679059448"><a href="#local-6989586621679059448"><span class="hs-identifier">err</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">OtherMachineError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">UnknownDynamicBuiltinNameErrorE</span><span> </span><a href="#local-6989586621679059446"><span class="hs-identifier hs-var">dynName</span></a><span>
</span><a name="line-108"></a><span>            </span><a name="local-6989586621679059449"><a href="#local-6989586621679059449"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Builtin</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">DynBuiltinName</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059446"><span class="hs-identifier hs-var">dynName</span></a><span>
</span><a name="line-109"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679059450"><a href="#local-6989586621679059450"><span class="hs-identifier">mean</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679059450"><span class="hs-identifier hs-var">mean</span></a><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">-- | The computing part of the CEK machine.</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- Either</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- 1. adds a frame to the context and calls 'computeCek' ('TyInst', 'Apply', 'IWrap', 'Unwrap')</span><span>
</span><a name="line-114"></a><span class="hs-comment">-- 2. calls 'returnCek' on values ('TyAbs', 'LamAbs', 'Constant')</span><span>
</span><a name="line-115"></a><span class="hs-comment">-- 3. returns 'EvaluationFailure' ('Error')</span><span>
</span><a name="line-116"></a><span class="hs-comment">-- 4. looks up a variable in the environment and calls 'returnCek' ('Var')</span><span>
</span><a name="line-117"></a><span class="hs-identifier">computeCek</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Context"><span class="hs-identifier hs-type">Context</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier hs-type">Plain</span></a><span> </span><span class="hs-identifier hs-type">Term</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier hs-type">CekM</span></a><span> </span><span class="hs-identifier hs-type">EvaluationResult</span><span>
</span><a name="line-118"></a><a name="computeCek"><a href="Language.PlutusCore.Interpreter.CekMachine.html#computeCek"><span class="hs-identifier">computeCek</span></a></a><span> </span><a name="local-6989586621679059451"><a href="#local-6989586621679059451"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyInst</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679059452"><a href="#local-6989586621679059452"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621679059453"><a href="#local-6989586621679059453"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#computeCek"><span class="hs-identifier hs-var">computeCek</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameTyInstArg"><span class="hs-identifier hs-var">FrameTyInstArg</span></a><span> </span><a href="#local-6989586621679059453"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679059451"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059452"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-119"></a><span class="hs-identifier">computeCek</span><span> </span><a name="local-6989586621679059454"><a href="#local-6989586621679059454"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Apply</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679059455"><a href="#local-6989586621679059455"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679059456"><a href="#local-6989586621679059456"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-120"></a><span>    </span><a name="local-6989586621679059457"><a href="#local-6989586621679059457"><span class="hs-identifier">varEnv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#getVarEnv"><span class="hs-identifier hs-var">getVarEnv</span></a><span>
</span><a name="line-121"></a><span>    </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#computeCek"><span class="hs-identifier hs-var">computeCek</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameApplyArg"><span class="hs-identifier hs-var">FrameApplyArg</span></a><span> </span><a href="#local-6989586621679059457"><span class="hs-identifier hs-var">varEnv</span></a><span> </span><a href="#local-6989586621679059456"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679059454"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059455"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-122"></a><span class="hs-identifier">computeCek</span><span> </span><a name="local-6989586621679059458"><a href="#local-6989586621679059458"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IWrap</span><span> </span><a name="local-6989586621679059459"><a href="#local-6989586621679059459"><span class="hs-identifier">ann</span></a></a><span> </span><a name="local-6989586621679059460"><a href="#local-6989586621679059460"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679059461"><a href="#local-6989586621679059461"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679059462"><a href="#local-6989586621679059462"><span class="hs-identifier">term</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#computeCek"><span class="hs-identifier hs-var">computeCek</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameIWrap"><span class="hs-identifier hs-var">FrameIWrap</span></a><span> </span><a href="#local-6989586621679059459"><span class="hs-identifier hs-var">ann</span></a><span> </span><a href="#local-6989586621679059460"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679059461"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679059458"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059462"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-123"></a><span class="hs-identifier">computeCek</span><span> </span><a name="local-6989586621679059463"><a href="#local-6989586621679059463"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Unwrap</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679059464"><a href="#local-6989586621679059464"><span class="hs-identifier">term</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#computeCek"><span class="hs-identifier hs-var">computeCek</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameUnwrap"><span class="hs-identifier hs-var">FrameUnwrap</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679059463"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059464"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-124"></a><span class="hs-identifier">computeCek</span><span> </span><a name="local-6989586621679059465"><a href="#local-6989586621679059465"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679059466"><a href="#local-6989586621679059466"><span class="hs-identifier">tyAbs</span></a></a><span class="hs-glyph">@</span><span class="hs-identifier hs-var">TyAbs</span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#returnCek"><span class="hs-identifier hs-var">returnCek</span></a><span> </span><a href="#local-6989586621679059465"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679059466"><span class="hs-identifier hs-var">tyAbs</span></a><span>
</span><a name="line-125"></a><span class="hs-identifier">computeCek</span><span> </span><a name="local-6989586621679059467"><a href="#local-6989586621679059467"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679059468"><a href="#local-6989586621679059468"><span class="hs-identifier">lamAbs</span></a></a><span class="hs-glyph">@</span><span class="hs-identifier hs-var">LamAbs</span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#returnCek"><span class="hs-identifier hs-var">returnCek</span></a><span> </span><a href="#local-6989586621679059467"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679059468"><span class="hs-identifier hs-var">lamAbs</span></a><span>
</span><a name="line-126"></a><span class="hs-identifier">computeCek</span><span> </span><a name="local-6989586621679059469"><a href="#local-6989586621679059469"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679059470"><a href="#local-6989586621679059470"><span class="hs-identifier">constant</span></a></a><span class="hs-glyph">@</span><span class="hs-identifier hs-var">Constant</span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#returnCek"><span class="hs-identifier hs-var">returnCek</span></a><span> </span><a href="#local-6989586621679059469"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679059470"><span class="hs-identifier hs-var">constant</span></a><span>
</span><a name="line-127"></a><span class="hs-identifier">computeCek</span><span> </span><a name="local-6989586621679059471"><a href="#local-6989586621679059471"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679059472"><a href="#local-6989586621679059472"><span class="hs-identifier">bi</span></a></a><span class="hs-glyph">@</span><span class="hs-identifier hs-var">Builtin</span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#returnCek"><span class="hs-identifier hs-var">returnCek</span></a><span> </span><a href="#local-6989586621679059471"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679059472"><span class="hs-identifier hs-var">bi</span></a><span>
</span><a name="line-128"></a><span class="hs-identifier">computeCek</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier hs-var">Error</span><span class="hs-special">{</span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">EvaluationFailure</span><span>
</span><a name="line-129"></a><span class="hs-identifier">computeCek</span><span> </span><a name="local-6989586621679059473"><a href="#local-6989586621679059473"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Var</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679059474"><a href="#local-6989586621679059474"><span class="hs-identifier">varName</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-130"></a><span>    </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Closure"><span class="hs-identifier hs-var">Closure</span></a><span> </span><a name="local-6989586621679059475"><a href="#local-6989586621679059475"><span class="hs-identifier">newVarEnv</span></a></a><span> </span><a name="local-6989586621679059476"><a href="#local-6989586621679059476"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#lookupVarName"><span class="hs-identifier hs-var">lookupVarName</span></a><span> </span><a href="#local-6989586621679059474"><span class="hs-identifier hs-var">varName</span></a><span>
</span><a name="line-131"></a><span>    </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#withVarEnv"><span class="hs-identifier hs-var">withVarEnv</span></a><span> </span><a href="#local-6989586621679059475"><span class="hs-identifier hs-var">newVarEnv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#returnCek"><span class="hs-identifier hs-var">returnCek</span></a><span> </span><a href="#local-6989586621679059473"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679059476"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-comment">-- | The returning part of the CEK machine.</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- Returns 'EvaluationSuccess' in case the context is empty, otherwise pops up one frame</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- from the context and either</span><span>
</span><a name="line-136"></a><span class="hs-comment">-- 1. performs reduction and calls 'computeCek' ('FrameTyInstArg', 'FrameApplyFun', 'FrameUnwrap')</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- 2. performs a constant application and calls 'returnCek' ('FrameTyInstArg', 'FrameApplyFun')</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- 3. puts 'FrameApplyFun' on top of the context and proceeds with the argument from 'FrameApplyArg'</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- 4. grows the resulting term ('FrameWrap')</span><span>
</span><a name="line-140"></a><span class="hs-identifier">returnCek</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Context"><span class="hs-identifier hs-type">Context</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier hs-type">Plain</span></a><span> </span><span class="hs-identifier hs-type">Value</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier hs-type">CekM</span></a><span> </span><span class="hs-identifier hs-type">EvaluationResult</span><span>
</span><a name="line-141"></a><a name="returnCek"><a href="Language.PlutusCore.Interpreter.CekMachine.html#returnCek"><span class="hs-identifier">returnCek</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                                  </span><a name="local-6989586621679059477"><a href="#local-6989586621679059477"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">EvaluationSuccess</span><span> </span><a href="#local-6989586621679059477"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-142"></a><span class="hs-identifier">returnCek</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameTyInstArg"><span class="hs-identifier hs-var">FrameTyInstArg</span></a><span> </span><a name="local-6989586621679059478"><a href="#local-6989586621679059478"><span class="hs-identifier">ty</span></a></a><span>           </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679059479"><a href="#local-6989586621679059479"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679059480"><a href="#local-6989586621679059480"><span class="hs-identifier">fun</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#instantiateEvaluate"><span class="hs-identifier hs-var">instantiateEvaluate</span></a><span> </span><a href="#local-6989586621679059479"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679059478"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679059480"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-143"></a><span class="hs-identifier">returnCek</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameApplyArg"><span class="hs-identifier hs-var">FrameApplyArg</span></a><span> </span><a name="local-6989586621679059481"><a href="#local-6989586621679059481"><span class="hs-identifier">argVarEnv</span></a></a><span> </span><a name="local-6989586621679059482"><a href="#local-6989586621679059482"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679059483"><a href="#local-6989586621679059483"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679059484"><a href="#local-6989586621679059484"><span class="hs-identifier">fun</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-144"></a><span>    </span><a name="local-6989586621679059485"><a href="#local-6989586621679059485"><span class="hs-identifier">funVarEnv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#getVarEnv"><span class="hs-identifier hs-var">getVarEnv</span></a><span>
</span><a name="line-145"></a><span>    </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#withVarEnv"><span class="hs-identifier hs-var">withVarEnv</span></a><span> </span><a href="#local-6989586621679059481"><span class="hs-identifier hs-var">argVarEnv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#computeCek"><span class="hs-identifier hs-var">computeCek</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameApplyFun"><span class="hs-identifier hs-var">FrameApplyFun</span></a><span> </span><a href="#local-6989586621679059485"><span class="hs-identifier hs-var">funVarEnv</span></a><span> </span><a href="#local-6989586621679059484"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679059483"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059482"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-146"></a><span class="hs-identifier">returnCek</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameApplyFun"><span class="hs-identifier hs-var">FrameApplyFun</span></a><span> </span><a name="local-6989586621679059486"><a href="#local-6989586621679059486"><span class="hs-identifier">funVarEnv</span></a></a><span> </span><a name="local-6989586621679059487"><a href="#local-6989586621679059487"><span class="hs-identifier">fun</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679059488"><a href="#local-6989586621679059488"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679059489"><a href="#local-6989586621679059489"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-147"></a><span>    </span><a name="local-6989586621679059490"><a href="#local-6989586621679059490"><span class="hs-identifier">argVarEnv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#getVarEnv"><span class="hs-identifier hs-var">getVarEnv</span></a><span>
</span><a name="line-148"></a><span>    </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#applyEvaluate"><span class="hs-identifier hs-var">applyEvaluate</span></a><span> </span><a href="#local-6989586621679059486"><span class="hs-identifier hs-var">funVarEnv</span></a><span> </span><a href="#local-6989586621679059490"><span class="hs-identifier hs-var">argVarEnv</span></a><span> </span><a href="#local-6989586621679059488"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679059487"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621679059489"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-149"></a><span class="hs-identifier">returnCek</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameIWrap"><span class="hs-identifier hs-var">FrameIWrap</span></a><span> </span><a name="local-6989586621679059491"><a href="#local-6989586621679059491"><span class="hs-identifier">ann</span></a></a><span> </span><a name="local-6989586621679059492"><a href="#local-6989586621679059492"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621679059493"><a href="#local-6989586621679059493"><span class="hs-identifier">arg</span></a></a><span>      </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679059494"><a href="#local-6989586621679059494"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679059495"><a href="#local-6989586621679059495"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#returnCek"><span class="hs-identifier hs-var">returnCek</span></a><span> </span><a href="#local-6989586621679059494"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">IWrap</span><span> </span><a href="#local-6989586621679059491"><span class="hs-identifier hs-var">ann</span></a><span> </span><a href="#local-6989586621679059492"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621679059493"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621679059495"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-150"></a><span class="hs-identifier">returnCek</span><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#FrameUnwrap"><span class="hs-identifier hs-var">FrameUnwrap</span></a><span>                 </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679059496"><a href="#local-6989586621679059496"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679059497"><a href="#local-6989586621679059497"><span class="hs-identifier">dat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679059497"><span class="hs-identifier hs-var">dat</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-151"></a><span>    </span><span class="hs-identifier hs-var">IWrap</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679059498"><a href="#local-6989586621679059498"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#returnCek"><span class="hs-identifier hs-var">returnCek</span></a><span> </span><a href="#local-6989586621679059496"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679059498"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-152"></a><span>    </span><a name="local-6989586621679059499"><a href="#local-6989586621679059499"><span class="hs-identifier">term</span></a></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">MachineException</span><span> </span><span class="hs-identifier hs-var">NonWrapUnwrappedMachineError</span><span> </span><a href="#local-6989586621679059499"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-comment">-- | Instantiate a term with a type and proceed.</span><span>
</span><a name="line-155"></a><span class="hs-comment">-- In case of 'TyAbs' just ignore the type. Otherwise check if the term is an</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- iterated application of a 'BuiltinName' to a list of 'Value's and, if succesful,</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- apply the term to the type via 'TyInst'.</span><span>
</span><a name="line-158"></a><span class="hs-identifier">instantiateEvaluate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Context"><span class="hs-identifier hs-type">Context</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-identifier hs-type">TyName</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier hs-type">Plain</span></a><span> </span><span class="hs-identifier hs-type">Term</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier hs-type">CekM</span></a><span> </span><span class="hs-identifier hs-type">EvaluationResult</span><span>
</span><a name="line-159"></a><a name="instantiateEvaluate"><a href="Language.PlutusCore.Interpreter.CekMachine.html#instantiateEvaluate"><span class="hs-identifier">instantiateEvaluate</span></a></a><span> </span><a name="local-6989586621679059500"><a href="#local-6989586621679059500"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyAbs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679059501"><a href="#local-6989586621679059501"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#computeCek"><span class="hs-identifier hs-var">computeCek</span></a><span> </span><a href="#local-6989586621679059500"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679059501"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-160"></a><span class="hs-identifier">instantiateEvaluate</span><span> </span><a name="local-6989586621679059502"><a href="#local-6989586621679059502"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679059503"><a href="#local-6989586621679059503"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679059504"><a href="#local-6989586621679059504"><span class="hs-identifier">fun</span></a></a><span>
</span><a name="line-161"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">termAsPrimIterApp</span><span> </span><a href="#local-6989586621679059504"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#returnCek"><span class="hs-identifier hs-var">returnCek</span></a><span> </span><a href="#local-6989586621679059502"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">TyInst</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059504"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621679059503"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-162"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                      </span><span class="hs-glyph">=</span><span>
</span><a name="line-163"></a><span>        </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">MachineException</span><span> </span><span class="hs-identifier hs-var">NonPrimitiveInstantiationMachineError</span><span> </span><a href="#local-6989586621679059504"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-comment">-- | Apply a function to an argument and proceed.</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- If the function is a 'LamAbs', then extend the current environment with a new variable and proceed.</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- If the function is not a 'LamAbs', then 'Apply' it to the argument and view this</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- as an iterated application of a 'BuiltinName' to a list of 'Value's.</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- If succesful, proceed with either this same term or with the result of the computation</span><span>
</span><a name="line-170"></a><span class="hs-comment">-- depending on whether 'BuiltinName' is saturated or not.</span><span>
</span><a name="line-171"></a><span class="hs-identifier">applyEvaluate</span><span>
</span><a name="line-172"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Context"><span class="hs-identifier hs-type">Context</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier hs-type">Plain</span></a><span> </span><span class="hs-identifier hs-type">Value</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier hs-type">Plain</span></a><span> </span><span class="hs-identifier hs-type">Value</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier hs-type">CekM</span></a><span> </span><span class="hs-identifier hs-type">EvaluationResult</span><span>
</span><a name="line-173"></a><a name="applyEvaluate"><a href="Language.PlutusCore.Interpreter.CekMachine.html#applyEvaluate"><span class="hs-identifier">applyEvaluate</span></a></a><span> </span><a name="local-6989586621679059529"><a href="#local-6989586621679059529"><span class="hs-identifier">funVarEnv</span></a></a><span> </span><a name="local-6989586621679059530"><a href="#local-6989586621679059530"><span class="hs-identifier">argVarEnv</span></a></a><span> </span><a name="local-6989586621679059531"><a href="#local-6989586621679059531"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LamAbs</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679059532"><a href="#local-6989586621679059532"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679059533"><a href="#local-6989586621679059533"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679059534"><a href="#local-6989586621679059534"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-174"></a><span>    </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#withVarEnv"><span class="hs-identifier hs-var">withVarEnv</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-6989586621679059532"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679059534"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621679059530"><span class="hs-identifier hs-var">argVarEnv</span></a><span> </span><a href="#local-6989586621679059529"><span class="hs-identifier hs-var">funVarEnv</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#computeCek"><span class="hs-identifier hs-var">computeCek</span></a><span> </span><a href="#local-6989586621679059531"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679059533"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-175"></a><span class="hs-identifier">applyEvaluate</span><span> </span><a name="local-6989586621679059535"><a href="#local-6989586621679059535"><span class="hs-identifier">funVarEnv</span></a></a><span> </span><span class="hs-identifier">_</span><span>         </span><a name="local-6989586621679059536"><a href="#local-6989586621679059536"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679059537"><a href="#local-6989586621679059537"><span class="hs-identifier">fun</span></a></a><span>                    </span><a name="local-6989586621679059538"><a href="#local-6989586621679059538"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-176"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679059539"><a href="#local-6989586621679059539"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Apply</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059537"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621679059538"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-177"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">termAsPrimIterApp</span><span> </span><a href="#local-6989586621679059539"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-178"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span>                       </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-179"></a><span>                </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">MachineException</span><span> </span><span class="hs-identifier hs-var">NonPrimitiveApplicationMachineError</span><span> </span><a href="#local-6989586621679059539"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-180"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IterApp</span><span> </span><a name="local-6989586621679059540"><a href="#local-6989586621679059540"><span class="hs-identifier">headName</span></a></a><span> </span><a name="local-6989586621679059541"><a href="#local-6989586621679059541"><span class="hs-identifier">spine</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-181"></a><span>                </span><a name="local-6989586621679059542"><a href="#local-6989586621679059542"><span class="hs-identifier">constAppResult</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">runQuoteT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#applyStagedBuiltinName"><span class="hs-identifier hs-var">applyStagedBuiltinName</span></a><span> </span><a href="#local-6989586621679059540"><span class="hs-identifier hs-var">headName</span></a><span> </span><a href="#local-6989586621679059541"><span class="hs-identifier hs-var">spine</span></a><span>
</span><a name="line-182"></a><span>                </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#withVarEnv"><span class="hs-identifier hs-var">withVarEnv</span></a><span> </span><a href="#local-6989586621679059535"><span class="hs-identifier hs-var">funVarEnv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679059542"><span class="hs-identifier hs-var">constAppResult</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-183"></a><span>                    </span><span class="hs-identifier hs-var">ConstAppSuccess</span><span> </span><a name="local-6989586621679059543"><a href="#local-6989586621679059543"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#computeCek"><span class="hs-identifier hs-var">computeCek</span></a><span> </span><a href="#local-6989586621679059536"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679059543"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-184"></a><span>                    </span><span class="hs-identifier hs-var">ConstAppFailure</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">EvaluationFailure</span><span>
</span><a name="line-185"></a><span>                    </span><span class="hs-identifier hs-var">ConstAppStuck</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#returnCek"><span class="hs-identifier hs-var">returnCek</span></a><span> </span><a href="#local-6989586621679059536"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679059539"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-186"></a><span>                    </span><span class="hs-identifier hs-var">ConstAppError</span><span>   </span><a name="local-6989586621679059544"><a href="#local-6989586621679059544"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-187"></a><span>                        </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">MachineException</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConstAppMachineError</span><span> </span><a href="#local-6989586621679059544"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059539"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span class="hs-identifier">evaluateInCekM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Evaluate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekMachineException"><span class="hs-identifier hs-type">CekMachineException</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679059011"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier hs-type">CekM</span></a><span> </span><a href="#local-6989586621679059011"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-190"></a><a name="evaluateInCekM"><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateInCekM"><span class="hs-identifier">evaluateInCekM</span></a></a><span> </span><a name="local-6989586621679059545"><a href="#local-6989586621679059545"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-191"></a><span>    </span><span class="hs-identifier hs-var">ReaderT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679059546"><a href="#local-6989586621679059546"><span class="hs-identifier">cekEnv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-192"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679059547"><a href="#local-6989586621679059547"><span class="hs-identifier">eval</span></a></a><span> </span><a name="local-6989586621679059548"><a href="#local-6989586621679059548"><span class="hs-identifier">means'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateCekCatchIn"><span class="hs-identifier hs-var">evaluateCekCatchIn</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679059546"><span class="hs-identifier hs-var">cekEnv</span></a><span> </span><span class="hs-operator hs-var">&amp;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#cekEnvMeans"><span class="hs-identifier hs-var">cekEnvMeans</span></a><span> </span><span class="hs-operator hs-var">%~</span><span> </span><span class="hs-identifier hs-var">mappend</span><span> </span><a href="#local-6989586621679059548"><span class="hs-identifier hs-var">means'</span></a><span>
</span><a name="line-193"></a><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">runEvaluate</span><span> </span><a href="#local-6989586621679059547"><span class="hs-identifier hs-var">eval</span></a><span> </span><a href="#local-6989586621679059545"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-comment">-- | Apply a 'StagedBuiltinName' to a list of 'Value's.</span><span>
</span><a name="line-196"></a><span class="hs-identifier">applyStagedBuiltinName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">StagedBuiltinName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier hs-type">Plain</span></a><span> </span><span class="hs-identifier hs-type">Value</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">QuoteT</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekM"><span class="hs-identifier hs-type">CekM</span></a><span> </span><span class="hs-identifier hs-type">ConstAppResult</span><span>
</span><a name="line-197"></a><a name="applyStagedBuiltinName"><a href="Language.PlutusCore.Interpreter.CekMachine.html#applyStagedBuiltinName"><span class="hs-identifier">applyStagedBuiltinName</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DynamicStagedBuiltinName</span><span> </span><a name="local-6989586621679059562"><a href="#local-6989586621679059562"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679059563"><a href="#local-6989586621679059563"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-198"></a><span>    </span><span class="hs-identifier hs-var">DynamicBuiltinNameMeaning</span><span> </span><a name="local-6989586621679059585"><a href="#local-6989586621679059585"><span class="hs-identifier">sch</span></a></a><span> </span><a name="local-6989586621679059586"><a href="#local-6989586621679059586"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#lookupDynamicBuiltinName"><span class="hs-identifier hs-var">lookupDynamicBuiltinName</span></a><span> </span><a href="#local-6989586621679059562"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-199"></a><span>    </span><span class="hs-identifier hs-var">hoist</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateInCekM"><span class="hs-identifier hs-var">evaluateInCekM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">applyTypeSchemed</span><span> </span><a href="#local-6989586621679059585"><span class="hs-identifier hs-var">sch</span></a><span> </span><a href="#local-6989586621679059586"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679059563"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-200"></a><span class="hs-identifier">applyStagedBuiltinName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StaticStagedBuiltinName</span><span>  </span><a name="local-6989586621679059587"><a href="#local-6989586621679059587"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679059588"><a href="#local-6989586621679059588"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-201"></a><span>    </span><span class="hs-identifier hs-var">hoist</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateInCekM"><span class="hs-identifier hs-var">evaluateInCekM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">applyBuiltinName</span><span> </span><a href="#local-6989586621679059587"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679059588"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-comment">-- | Evaluate a term in an environment using the CEK machine.</span><span>
</span><a name="line-204"></a><span class="hs-identifier">evaluateCekCatchIn</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekEnv"><span class="hs-identifier hs-type">CekEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier hs-type">Plain</span></a><span> </span><span class="hs-identifier hs-type">Term</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekMachineException"><span class="hs-identifier hs-type">CekMachineException</span></a><span> </span><span class="hs-identifier hs-type">EvaluationResult</span><span>
</span><a name="line-206"></a><a name="evaluateCekCatchIn"><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateCekCatchIn"><span class="hs-identifier">evaluateCekCatchIn</span></a></a><span> </span><a name="local-6989586621679059589"><a href="#local-6989586621679059589"><span class="hs-identifier">cekEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#runCekM"><span class="hs-identifier hs-var">runCekM</span></a><span> </span><a href="#local-6989586621679059589"><span class="hs-identifier hs-var">cekEnv</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#computeCek"><span class="hs-identifier hs-var">computeCek</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-comment">-- | Evaluate a term using the CEK machine.</span><span>
</span><a name="line-209"></a><span class="hs-identifier">evaluateCekCatch</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynamicBuiltinNameMeanings</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#Plain"><span class="hs-identifier hs-type">Plain</span></a><span> </span><span class="hs-identifier hs-type">Term</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekMachineException"><span class="hs-identifier hs-type">CekMachineException</span></a><span> </span><span class="hs-identifier hs-type">EvaluationResult</span><span>
</span><a name="line-211"></a><a name="evaluateCekCatch"><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateCekCatch"><span class="hs-identifier">evaluateCekCatch</span></a></a><span> </span><a name="local-6989586621679059590"><a href="#local-6989586621679059590"><span class="hs-identifier">means</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateCekCatchIn"><span class="hs-identifier hs-var">evaluateCekCatchIn</span></a><span> </span><span class="hs-special">(</span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekEnv"><span class="hs-identifier hs-var">CekEnv</span></a><span> </span><a href="#local-6989586621679059590"><span class="hs-identifier hs-var">means</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#VarEnv"><span class="hs-identifier hs-var">VarEnv</span></a><span> </span><span class="hs-identifier hs-var">IntMap.empty</span><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span class="hs-comment">-- | Evaluate a term using the CEK machine. May throw a 'CekMachineException'.</span><span>
</span><a name="line-214"></a><span class="hs-identifier">evaluateCek</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynamicBuiltinNameMeanings</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Term</span><span> </span><span class="hs-identifier hs-type">TyName</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EvaluationResult</span><span>
</span><a name="line-215"></a><a name="evaluateCek"><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateCek"><span class="hs-identifier">evaluateCek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-identifier hs-var">throw</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">.*</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateCekCatch"><span class="hs-identifier hs-var">evaluateCekCatch</span></a><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-identifier">readDynamicBuiltinCek</span><span>
</span><a name="line-218"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">KnownDynamicBuiltinType</span><span> </span><a href="#local-6989586621679056755"><span class="hs-identifier hs-type">dyn</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Term</span><span> </span><span class="hs-identifier hs-type">TyName</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#CekMachineException"><span class="hs-identifier hs-type">CekMachineException</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679056755"><span class="hs-identifier hs-type">dyn</span></a><span class="hs-special">)</span><span>
</span><a name="line-219"></a><a name="readDynamicBuiltinCek"><a href="Language.PlutusCore.Interpreter.CekMachine.html#readDynamicBuiltinCek"><span class="hs-identifier">readDynamicBuiltinCek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">readDynamicBuiltin</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateCekCatch"><span class="hs-identifier hs-var">evaluateCekCatch</span></a><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-comment">-- | Run a program using the CEK machine. May throw a 'CekMachineException'.</span><span>
</span><a name="line-222"></a><span class="hs-comment">-- Calls 'evaluateCek' under the hood.</span><span>
</span><a name="line-223"></a><span class="hs-identifier">runCek</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynamicBuiltinNameMeanings</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Program</span><span> </span><span class="hs-identifier hs-type">TyName</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EvaluationResult</span><span>
</span><a name="line-224"></a><a name="runCek"><a href="Language.PlutusCore.Interpreter.CekMachine.html#runCek"><span class="hs-identifier">runCek</span></a></a><span> </span><a name="local-6989586621679059970"><a href="#local-6989586621679059970"><span class="hs-identifier">means</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Program</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679059971"><a href="#local-6989586621679059971"><span class="hs-identifier">term</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.PlutusCore.Interpreter.CekMachine.html#evaluateCek"><span class="hs-identifier hs-var">evaluateCek</span></a><span> </span><a href="#local-6989586621679059970"><span class="hs-identifier hs-var">means</span></a><span> </span><a href="#local-6989586621679059971"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-225"></a></pre></body></html>